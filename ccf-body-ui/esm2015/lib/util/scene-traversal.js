/* eslint-disable @typescript-eslint/no-unsafe-member-access */
import { Matrix4 } from '@math.gl/core';
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
export function traverseScene(scene, worldMatrix, visitor) {
    if (!worldMatrix) {
        worldMatrix = new Matrix4(Matrix4.IDENTITY);
    }
    const matrix = new Matrix4(Matrix4.IDENTITY);
    if (!scene) {
        return true;
    }
    else if (scene.matrix) {
        matrix.copy(scene.matrix);
    }
    else {
        matrix.identity();
        if (scene.translation) {
            matrix.translate(scene.translation);
        }
        if (scene.rotation) {
            const rotationMatrix = new Matrix4(Matrix4.IDENTITY).fromQuaternion(scene.rotation);
            matrix.multiplyRight(rotationMatrix);
        }
        if (scene.scale) {
            matrix.scale(scene.scale);
        }
    }
    const modelMatrix = new Matrix4(worldMatrix).multiplyRight(matrix);
    if (visitor(scene, modelMatrix, worldMatrix) === false) {
        return false;
    }
    for (const child of (scene.nodes || scene.children || [])) {
        if (traverseScene(child, modelMatrix, visitor) === false) {
            return false;
        }
    }
    return true;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtdHJhdmVyc2FsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY2NmLWJvZHktdWkvc3JjL2xpYi91dGlsL3NjZW5lLXRyYXZlcnNhbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUt4Qyw2RUFBNkU7QUFDN0UsTUFBTSxVQUFVLGFBQWEsQ0FBQyxLQUFLLEVBQUUsV0FBb0IsRUFBRSxPQUE4QjtJQUN2RixJQUFJLENBQUMsV0FBVyxFQUFFO1FBQ2hCLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDN0M7SUFDRCxNQUFNLE1BQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDN0MsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNWLE9BQU8sSUFBSSxDQUFDO0tBQ2I7U0FBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUU7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDM0I7U0FBTTtRQUNMLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUVsQixJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUU7WUFDckIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDckM7UUFFRCxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUU7WUFDbEIsTUFBTSxjQUFjLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEYsTUFBTSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztTQUN0QztRQUVELElBQUksS0FBSyxDQUFDLEtBQUssRUFBRTtZQUNmLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQzNCO0tBQ0Y7SUFDRCxNQUFNLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkUsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxXQUFXLENBQUMsS0FBSyxLQUFLLEVBQUU7UUFDdEQsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUNELEtBQUssTUFBTSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLEVBQUU7UUFDekQsSUFBSSxhQUFhLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsS0FBSyxLQUFLLEVBQUU7WUFDeEQsT0FBTyxLQUFLLENBQUM7U0FDZDtLQUNGO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzICovXG5pbXBvcnQgeyBNYXRyaXg0IH0gZnJvbSAnQG1hdGguZ2wvY29yZSc7XG5cblxuZXhwb3J0IHR5cGUgU2NlbmVUcmF2ZXJzYWxWaXNpdG9yID0gKGNoaWxkLCBtb2RlbE1hdHJpeDogTWF0cml4NCwgcGFyZW50TWF0cml4OiBNYXRyaXg0KSA9PiBib29sZWFuO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2V4cGxpY2l0LW1vZHVsZS1ib3VuZGFyeS10eXBlc1xuZXhwb3J0IGZ1bmN0aW9uIHRyYXZlcnNlU2NlbmUoc2NlbmUsIHdvcmxkTWF0cml4OiBNYXRyaXg0LCB2aXNpdG9yOiBTY2VuZVRyYXZlcnNhbFZpc2l0b3IpOiBib29sZWFuIHtcbiAgaWYgKCF3b3JsZE1hdHJpeCkge1xuICAgIHdvcmxkTWF0cml4ID0gbmV3IE1hdHJpeDQoTWF0cml4NC5JREVOVElUWSk7XG4gIH1cbiAgY29uc3QgbWF0cml4ID0gbmV3IE1hdHJpeDQoTWF0cml4NC5JREVOVElUWSk7XG4gIGlmICghc2NlbmUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChzY2VuZS5tYXRyaXgpIHtcbiAgICBtYXRyaXguY29weShzY2VuZS5tYXRyaXgpO1xuICB9IGVsc2Uge1xuICAgIG1hdHJpeC5pZGVudGl0eSgpO1xuXG4gICAgaWYgKHNjZW5lLnRyYW5zbGF0aW9uKSB7XG4gICAgICBtYXRyaXgudHJhbnNsYXRlKHNjZW5lLnRyYW5zbGF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoc2NlbmUucm90YXRpb24pIHtcbiAgICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoTWF0cml4NC5JREVOVElUWSkuZnJvbVF1YXRlcm5pb24oc2NlbmUucm90YXRpb24pO1xuICAgICAgbWF0cml4Lm11bHRpcGx5UmlnaHQocm90YXRpb25NYXRyaXgpO1xuICAgIH1cblxuICAgIGlmIChzY2VuZS5zY2FsZSkge1xuICAgICAgbWF0cml4LnNjYWxlKHNjZW5lLnNjYWxlKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgbW9kZWxNYXRyaXggPSBuZXcgTWF0cml4NCh3b3JsZE1hdHJpeCkubXVsdGlwbHlSaWdodChtYXRyaXgpO1xuICBpZiAodmlzaXRvcihzY2VuZSwgbW9kZWxNYXRyaXgsIHdvcmxkTWF0cml4KSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChjb25zdCBjaGlsZCBvZiAoc2NlbmUubm9kZXMgfHwgc2NlbmUuY2hpbGRyZW4gfHwgW10pKSB7XG4gICAgaWYgKHRyYXZlcnNlU2NlbmUoY2hpbGQsIG1vZGVsTWF0cml4LCB2aXNpdG9yKSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG4iXX0=