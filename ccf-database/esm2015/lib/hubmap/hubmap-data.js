import { get, omit, set, toNumber } from 'lodash';
const HBM_PREFIX = 'https://entity.api.hubmapconsortium.org/entities/';
// eslint-disable-next-line max-len
export const DR1_VU_THUMBS = new Set(['VAN0003-LK-32-21-AF_preIMS_registered_thumbnail.jpg', 'VAN0003-LK-32-21-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0003-LK-32-21-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0003-LK-32-21-PAS_registered_thumbnail.jpg', 'VAN0003-LK-32-22-AF_preMxIF_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0005-RK-1-1-AF_preIMS_registered_thumbnail.jpg', 'VAN0005-RK-1-1-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0005-RK-1-1-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0005-RK-1-1-PAS_registered_thumbnail.jpg', 'VAN0005-RK-4-172-AF_preIMS_registered_thumbnail.jpg', 'VAN0005-RK-4-172-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0005-RK-4-172-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0005-RK-4-172-PAS_registered_thumbnail.jpg', 'VAN0006-LK-2-85-AF_preIMS_registered_thumbnail.jpg', 'VAN0006-LK-2-85-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0006-LK-2-85-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0006-LK-2-85-PAS_registered_thumbnail.jpg', 'VAN0006-LK-2-86-AF_preMxIF_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0007-LK-203-103-AF_preIMS_registered_thumbnail.jpg', 'VAN0007-LK-203-103-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0007-LK-203-103-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0007-LK-203-103-PAS_registered_thumbnail.jpg', 'VAN0008-RK-403-100-AF_preIMS_registered_thumbnail.jpg', 'VAN0008-RK-403-100-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0008-RK-403-100-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0008-RK-403-100-PAS_registered_thumbnail.jpg', 'VAN0008-RK-403-101-AF_preMxIF_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0009-LK-102-7-AF_preIMS_registered_thumbnail.jpg', 'VAN0009-LK-102-7-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0009-LK-102-7-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0009-LK-102-7-PAS_registered_thumbnail.jpg', 'VAN0010-LK-155-40-AF_preIMS_registered_thumbnail.jpg', 'VAN0010-LK-155-40-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0010-LK-155-40-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0010-LK-155-40-PAS_registered_thumbnail.jpg', 'VAN0011-RK-3-10-AF_preIMS_registered_thumbnail.jpg', 'VAN0011-RK-3-10-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0011-RK-3-10-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0011-RK-3-10-PAS_registered_thumbnail.jpg', 'VAN0011-RK-3-11-AF_preMxIF_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0012-RK-103-75-AF_preIMS_registered_thumbnail.jpg', 'VAN0012-RK-103-75-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0012-RK-103-75-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0012-RK-103-75-PAS_registered_thumbnail.jpg', 'VAN0012-RK-103-76-AF_preMxIF_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0013-LK-202-96-AF_preIMS_registered_thumbnail.jpg', 'VAN0013-LK-202-96-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0013-LK-202-96-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0013-LK-202-96-PAS_registered_thumbnail.jpg', 'VAN0013-LK-202-97-AF_preMxIF_registered_thumbnail.jpg', 'VAN0013-LK-202-97-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0013-LK-202-97-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0013-LK-202-97-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0014-LK-203-108-AF_preIMS_registered_thumbnail.jpg', 'VAN0014-LK-203-108-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0014-LK-203-108-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0014-LK-203-108-PAS_registered_thumbnail.jpg', 'VAN0016-LK-202-89-AF_preIMS_registered_thumbnail.jpg', 'VAN0016-LK-202-89-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0016-LK-202-89-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0016-LK-202-89-PAS_registered_thumbnail.jpg', 'VAN0003-LK-32-21-AF_preIMS_registered_thumbnail.jpg', 'VAN0003-LK-32-21-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0003-LK-32-21-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0003-LK-32-21-PAS_registered_thumbnail.jpg', 'VAN0003-LK-32-22-AF_preMxIF_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0003-LK-32-22-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0005-RK-1-1-AF_preIMS_registered_thumbnail.jpg', 'VAN0005-RK-1-1-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0005-RK-1-1-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0005-RK-1-1-PAS_registered_thumbnail.jpg', 'VAN0005-RK-4-172-AF_preIMS_registered_thumbnail.jpg', 'VAN0005-RK-4-172-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0005-RK-4-172-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0005-RK-4-172-PAS_registered_thumbnail.jpg', 'VAN0006-LK-2-85-AF_preIMS_registered_thumbnail.jpg', 'VAN0006-LK-2-85-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0006-LK-2-85-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0006-LK-2-85-PAS_registered_thumbnail.jpg', 'VAN0006-LK-2-86-AF_preMxIF_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0006-LK-2-86-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0007-LK-203-103-AF_preIMS_registered_thumbnail.jpg', 'VAN0007-LK-203-103-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0007-LK-203-103-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0007-LK-203-103-PAS_registered_thumbnail.jpg', 'VAN0008-RK-403-100-AF_preIMS_registered_thumbnail.jpg', 'VAN0008-RK-403-100-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0008-RK-403-100-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0008-RK-403-100-PAS_registered_thumbnail.jpg', 'VAN0008-RK-403-101-AF_preMxIF_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0008-RK-403-101-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0011-RK-3-10-AF_preIMS_registered_thumbnail.jpg', 'VAN0011-RK-3-10-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0011-RK-3-10-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0011-RK-3-10-PAS_registered_thumbnail.jpg', 'VAN0011-RK-3-11-AF_preMxIF_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0011-RK-3-11-MxIF_cyc3_registered_thumbnail.jpg', 'VAN0012-RK-103-75-AF_preIMS_registered_thumbnail.jpg', 'VAN0012-RK-103-75-IMS_NegMode_multilayer_thumbnail.jpg', 'VAN0012-RK-103-75-IMS_PosMode_multilayer_thumbnail.jpg', 'VAN0012-RK-103-75-PAS_registered_thumbnail.jpg', 'VAN0012-RK-103-76-AF_preMxIF_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc1_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc2_registered_thumbnail.jpg', 'VAN0012-RK-103-76-MxIF_cyc3_registered_thumbnail.jpg']);
// eslint-disable-next-line max-len
export const UFL_THUMBS = { 'HBM558.SRZG.629': 'HBM558.SRZG.629_UFL0002-SP-3-4-1.jpg', 'HBM562.NTMH.548': 'HBM562.NTMH.548_UFL0006-SP-1-2-1.jpg', 'HBM685.KHRQ.684': 'HBM685.KHRQ.684_UFL0008-LY07-1-1.jpg', 'HBM278.SFQW.627': 'HBM278.SFQW.627_UFL0008-LY09-1-1.jpg', 'HBM427.SMGB.866': 'HBM427.SMGB.866_UFL0004-SP-1-4-1.jpg', 'HBM432.LLCF.677': 'HBM432.LLCF.677_UFL0001-SP-2-5-1.jpg', 'HBM586.ZSVS.996': 'HBM586.ZSVS.996_UFL0008-SP-1-1-1.jpg', 'HBM285.XMBT.542': 'HBM285.XMBT.542_UFL0006-TH-1-3-1.jpg', 'HBM289.BWJW.663': 'HBM289.BWJW.663_UFL0006-TH-1-2-1.jpg', 'HBM255.SRPR.985': 'HBM255.SRPR.985_UFL0005-TH-2-2-1.jpg', 'HBM799.WXHD.535': 'HBM799.WXHD.535_UFL0009-LY02-1-1.jpg', 'HBM294.RZFN.624': 'HBM294.RZFN.624_UFL0005-TH-1-1-1.jpg', 'HBM383.TRQG.424': 'HBM383.TRQG.424_UFL0006-SP-1-3-1.jpg', 'HBM647.MFQB.496': 'HBM647.MFQB.496_UFL0001-SP-1-2-1.jpg', 'HBM237.GGPR.739': 'HBM237.GGPR.739_UFL0006-LY01-1-1.jpg', 'HBM288.TPBD.654': 'HBM288.TPBD.654_UFL0003-SP-2-2-1.jpg', 'HBM974.NDXT.675': 'HBM974.NDXT.675_UFL0008-TH-2-2-1.jpg', 'HBM589.SLVV.423': 'HBM589.SLVV.423_UFL0008-LY10-1-1.jpg', 'HBM794.RLFN.358': 'HBM794.RLFN.358_UFL0006-LY03-1-1.jpg', 'HBM372.BQSR.778': 'HBM372.BQSR.778_UFL0007-SP-1-1-1.jpg', 'HBM499.TKDW.458': 'HBM499.TKDW.458_UFL0009-LY03-1-1.jpg', 'HBM342.PRQB.739': 'HBM342.PRQB.739_UFL0003-LY06-1-1.jpg', 'HBM633.CLVN.674': 'HBM633.CLVN.674_UFL0003-SP-3-6-1.jpg', 'HBM343.JQKM.578': 'HBM343.JQKM.578_UFL0009-LY01-1-1.jpg', 'HBM987.XGTH.368': 'HBM987.XGTH.368_UFL0002-SP-2-4-1.jpg', 'HBM964.CWCP.788': 'HBM964.CWCP.788_UFL0006-LY02-2-1.jpg', 'HBM244.TJLK.223': 'HBM244.TJLK.223_UFL0003-SP-1-4-1.jpg', 'HBM646.FSBQ.966': 'HBM646.FSBQ.966_UFL0007-SP-2-2-1.jpg', 'HBM572.GXSB.234': 'HBM572.GXSB.234_UFL0003-SP-3-2-1.jpg', 'HBM772.TKGJ.794': 'HBM772.TKGJ.794_UFL0008-SP-2-1-1.jpg', 'HBM239.CBWR.263': 'HBM239.CBWR.263_UFL0008-SP-1-2-1.jpg', 'HBM992.NRTT.383': 'HBM992.NRTT.383_UFL0006-SP-1-1-1.jpg', 'HBM283.DQXD.546': 'HBM283.DQXD.546_UFL0003-SP-1-2-1.jpg', 'HBM795.JHND.856': 'HBM795.JHND.856_UFL0007-SP-1-2-1.jpg', 'HBM267.BZKT.867': 'HBM267.BZKT.867_UFL0003-SP-2-6-1.jpg', 'HBM838.DLMJ.782': 'HBM838.DLMJ.782_UFL0008-TH-1-1-1.jpg', 'HBM337.FSXL.564': 'HBM337.FSXL.564_UFL0001-SP-3-8-2.jpg', 'HBM355.JDLK.244': 'HBM355.JDLK.244_UFL0004-SP-2-4-1.jpg', 'HBM599.PSZG.737': 'HBM599.PSZG.737_UFL0006-LY02-1-1.jpg' };
/** UUID to TMC mapping. */
const GROUP_UUID_MAPPING = {
    '03b3d854-ed44-11e8-8bce-0e368f3075e8': 'TMC-UCSD',
    '07a29e4c-ed43-11e8-b56a-0e8017bdda58': 'TMC-Florida',
    '308f5ffc-ed43-11e8-b56a-0e8017bdda58': 'TMC-CalTech',
    '5bd084c8-edc2-11e8-802f-0e368f3075e8': 'HBM-TestingGroup',
    '73bb26e4-ed43-11e8-8f19-0a7c1eab007a': 'TMC-Vanderbilt',
    'def5fd76-ed43-11e8-b56a-0e8017bdda58': 'TMC-Stanford',
    '5c106f29-ea2d-11e9-85e8-0efb3ba9a670': 'RTI-General Electric',
    '301615f9-c870-11eb-a8dc-35ce3d8786fe': 'TMC-UConn'
};
const ENTITY_CONTEXT = {
    '@base': 'http://purl.org/ccf/latest/ccf-entity.owl#',
    '@vocab': 'http://purl.org/ccf/latest/ccf-entity.owl#',
    ccf: 'http://purl.org/ccf/',
    rdfs: 'http://www.w3.org/2000/01/rdf-schema#',
    label: 'rdfs:label',
    description: 'rdfs:comment',
    link: {
        '@id': 'rdfs:seeAlso',
        '@type': '@id'
    },
    samples: {
        '@reverse': 'has_donor'
    },
    sections: {
        '@id': 'has_tissue_section',
        '@type': '@id'
    },
    datasets: {
        '@id': 'has_dataset',
        '@type': '@id'
    },
    // eslint-disable-next-line @typescript-eslint/naming-convention
    rui_location: {
        '@id': 'has_spatial_entity',
        '@type': '@id'
    },
    ontologyTerms: {
        '@id': 'has_ontology_term',
        '@type': '@id'
    },
    cellTypeTerms: {
        '@id': 'has_cell_type_term',
        '@type': '@id'
    },
    thumbnail: {
        '@id': 'has_thumbnail'
    }
};
/**
 * Converts a hubmap response object into JsonLd.
 *
 * @param data The hubmap data.
 * @returns The converted data.
 */
export function hubmapResponseAsJsonLd(data, assetsApi = '', portalUrl = '', serviceToken, debug = false) {
    const entries = get(data, 'hits.hits', [])
        .map(e => get(e, '_source', {}))
        .sort((a, b) => a['uuid'].localeCompare(b['uuid']));
    const donorLookup = {};
    const unflattened = entries.map(e => new HuBMAPTissueBlock(e, assetsApi, portalUrl, serviceToken).toJsonLd());
    for (const donor of unflattened) {
        const donorId = donor['@id'];
        if (!donorLookup[donorId]) {
            donorLookup[donorId] = donor;
        }
        else {
            const samples = donorLookup[donorId].samples;
            samples.push(donor.samples[0]);
        }
    }
    const donors = Object.values(donorLookup);
    if (debug) {
        debugDonors(donors);
        console.log(donors.map(d => (Object.assign({ '@context': ENTITY_CONTEXT }, d))));
    }
    return { '@context': ENTITY_CONTEXT, '@graph': donors };
}
function debugDonors(donors) {
    let datasets = [];
    let deleted = 0;
    for (const donor of donors.filter(d => d.samples.length > 1)) {
        const samples = donor.samples;
        for (let i = 0; i < samples.length; i++) {
            const blockId = samples[i]['@id'];
            datasets = datasets.concat(samples[i].datasets);
            for (const section of samples[i].sections) {
                datasets = datasets.concat(section.datasets);
            }
            for (let j = i + 1; j < samples.length; j++) {
                const sections = samples[j].sections;
                if (sections.find(s => s['@id'] === blockId)) {
                    samples[i].deleteMe = true;
                    deleted++;
                }
            }
        }
        donor.samples = samples.filter(s => s.deleteMe !== true);
    }
    if (deleted > 0) {
        console.log(`⚠ ${deleted} sections identified as blocks`);
    }
}
export class HuBMAPTissueBlock {
    constructor(data, assetsApi = '', portalUrl = '', serviceToken) {
        var _a, _b;
        this.data = data;
        this.bad = false;
        this['@type'] = 'Sample';
        this.sample_type = 'Tissue Block';
        const entityType = this.data.entity_type;
        if (entityType !== 'Sample') {
            this.bad = true;
            return;
        }
        const ancestors = (this.data.ancestors || []);
        const descendants = (this.data.descendants || []);
        const donor = ancestors.find(e => e.entity_type === 'Donor');
        this.donor = this.getDonor(donor, portalUrl);
        const ruiLocation = this.getRuiLocation(data, this.donor);
        if (!ruiLocation) {
            this.bad = true;
        }
        else {
            this.rui_location = ruiLocation;
        }
        if (!GROUP_UUID_MAPPING[data.group_uuid]) {
            GROUP_UUID_MAPPING[data.group_uuid] = data.group_name;
        }
        const dateEntered = new Date(data.last_modified_timestamp).toLocaleDateString();
        const groupName = GROUP_UUID_MAPPING[data.group_uuid] || data.group_name;
        const creator = data.created_by_user_displayname;
        this['@id'] = HBM_PREFIX + data.uuid;
        this.label = `Registered ${dateEntered}, ${creator}, ${groupName}`;
        this.link = `${portalUrl}browse/sample/${data.uuid}`;
        const sectionLookup = {};
        const sections = [];
        this.sections = sections;
        const datasets = [];
        this.datasets = datasets;
        for (const descendant of descendants.filter(d => d.entity_type === 'Sample')) {
            const section = this.getSection(descendant, data, portalUrl);
            const sectionId = descendant.submission_id;
            sectionLookup[sectionId] = section;
            sections.push(section);
            section.section_number = (_a = section.section_number) !== null && _a !== void 0 ? _a : sections.length;
        }
        for (const descendant of descendants) {
            if (descendant.entity_type === 'Dataset') {
                const dataset = this.getDataset(descendant, assetsApi, portalUrl, serviceToken);
                const sectionId = get(descendant, ['ingest_metadata', 'metadata', 'tissue_id']);
                if (sectionLookup[sectionId]) {
                    (_b = sectionLookup[sectionId].datasets) === null || _b === void 0 ? void 0 : _b.push(dataset);
                }
                else {
                    datasets.push(dataset);
                }
            }
        }
        const loc = ruiLocation !== null && ruiLocation !== void 0 ? ruiLocation : {};
        const dims = `${loc.x_dimension} x ${loc.y_dimension} x ${loc.z_dimension} ${loc.dimension_units}`;
        this.section_count = loc.slice_count || sections.length;
        const sSize = parseFloat((loc.slice_thickness ||
            ((loc.z_dimension || 0) / Math.max(this.section_count, 1)))
            .toFixed(1));
        this.section_size = sSize;
        const sUnits = loc.dimension_units || 'millimeter';
        this.section_units = sUnits;
        this.description = `${dims}, ${sSize} ${sUnits}, ${data.specimen_type}, ${this.section_count} Sections`;
        sections.forEach((section, index) => {
            section.description = `${loc.x_dimension} x ${loc.y_dimension} x ${sSize} ${sUnits}, ${sSize} ${sUnits}, ${section.description}`;
            section.section_number = index + 1;
        });
    }
    getSection(section, data, portalUrl) {
        const dateEntered = new Date(section.last_modified_timestamp).toLocaleDateString();
        const groupName = GROUP_UUID_MAPPING[section.group_uuid] || section.group_name;
        const creator = section.created_by_user_displayname;
        return {
            '@id': HBM_PREFIX + section.uuid,
            '@type': 'Sample',
            label: `Registered ${dateEntered}, ${creator}, ${groupName}`,
            description: `${data.specimen_type}`,
            link: `${portalUrl}browse/sample/${section.uuid}`,
            sample_type: 'Tissue Section',
            section_number: 1,
            samples: [],
            datasets: []
        };
    }
    getDataset(dataset, assetsApi = '', portalUrl = '', serviceToken) {
        var _a;
        const dateEntered = new Date(dataset.last_modified_timestamp).toLocaleDateString();
        const groupName = GROUP_UUID_MAPPING[dataset.group_uuid] || dataset.group_name;
        const creator = dataset.created_by_user_displayname;
        const types = [
            ...dataset.data_types,
            get(dataset, ['ingest_metadata', 'metadata', 'assay_type'], '')
        ];
        const typesSearch = types.join('|').toLowerCase();
        let technology;
        let thumbnail = 'assets/icons/ico-unknown.svg';
        if (typesSearch.indexOf('10x') !== -1) {
            technology = '10x';
            thumbnail = 'assets/icons/ico-bulk-10x.svg';
        }
        else if (typesSearch.indexOf('af') !== -1) {
            technology = 'AF';
            thumbnail = 'assets/icons/ico-spatial-af.svg';
        }
        else if (typesSearch.indexOf('codex') !== -1) {
            technology = 'CODEX';
            thumbnail = 'assets/icons/ico-spatial-codex.svg';
        }
        else if (typesSearch.indexOf('imc') !== -1) {
            technology = 'IMC';
            thumbnail = 'assets/icons/ico-spatial-imc.svg';
        }
        else if ((typesSearch.indexOf('lc') !== -1) && (typesSearch.indexOf('af') === -1)) {
            technology = 'LC';
            thumbnail = 'assets/icons/ico-bulk-lc.svg';
        }
        else if (typesSearch.indexOf('maldi') !== -1) {
            technology = 'MALDI';
        }
        else if (typesSearch.indexOf('pas') !== -1) {
            technology = 'PAS';
        }
        else {
            technology = 'OTHER';
        }
        thumbnail = (_a = this.getDatasetThumbnail(dataset, assetsApi, serviceToken)) !== null && _a !== void 0 ? _a : thumbnail;
        return {
            '@id': HBM_PREFIX + dataset.uuid,
            '@type': 'Dataset',
            label: `Registered ${dateEntered}, ${creator}, ${groupName}`,
            description: `Data/Assay Types: ${types.join(', ')}`,
            link: `${portalUrl}browse/dataset/${dataset.uuid}`,
            technology,
            thumbnail
        };
    }
    getDatasetThumbnail(dataset, assetsApi, serviceToken) {
        if (dataset.thumbnail_file) {
            const thumbnailFile = dataset.thumbnail_file;
            return `${assetsApi}/${thumbnailFile.file_uuid}/${thumbnailFile.filename}` + (serviceToken ? `?token=${serviceToken}` : '');
        }
        else if (dataset.group_uuid === '73bb26e4-ed43-11e8-8f19-0a7c1eab007a') { // TMC-Vanderbilt
            const tiffs = get(dataset, 'metadata.files', [])
                .filter(f => /\.(ome\.tif|ome\.tiff)$/.test(f.rel_path))
                .filter(f => !/(multilayer\.ome\.tif|_ac\.ome\.tif)/.test(f.rel_path))
                .filter(f => DR1_VU_THUMBS.has(f.rel_path.split('/').slice(-1)[0].split('?')[0].replace('.ome.tif', '_thumbnail.jpg')))
                .map(f => `${assetsApi}/${dataset.uuid}/${f.rel_path}` + (serviceToken ? `?token=${serviceToken}` : ''));
            if (tiffs.length > 0) {
                const thumb = tiffs[0].split('/').slice(-1)[0].split('?')[0].replace('.ome.tif', '_thumbnail.jpg');
                if (DR1_VU_THUMBS.has(thumb)) {
                    return `assets/thumbnails/TMC-Vanderbilt/DR1/${thumb}`;
                }
            }
        }
        else if (dataset.group_uuid === '07a29e4c-ed43-11e8-b56a-0e8017bdda58') { // TMC-Florida
            const thumb = UFL_THUMBS[dataset.hubmap_id];
            if (thumb) {
                return `assets/thumbnails/TMC-Florida/${thumb}`;
            }
        }
        return undefined;
    }
    getDonor(donor, portalUrl) {
        const donorDescription = (donor.description || '').toLowerCase();
        let sex;
        if (donorDescription.includes('female')) {
            sex = 'Female';
        }
        else if (donorDescription.includes('male')) {
            sex = 'Male';
        }
        const ageMatch = donorDescription.match(/age ([0-9]+)/);
        let age;
        if (ageMatch) {
            age = toNumber(ageMatch[1]);
        }
        let bmi;
        for (const md of get(donor, 'metadata.organ_donor_data', get(donor, 'metadata.living_donor_data', []))) {
            if (md.preferred_term === 'Feminine gender' || md.preferred_term === 'Female') {
                sex = 'Female';
            }
            else if (md.preferred_term === 'Masculine gender' || md.preferred_term === 'Male') {
                sex = 'Male';
            }
            else if (md.preferred_term === 'Current chronological age' || md.preferred_term === 'Age') {
                age = toNumber(md.data_value);
            }
            else if (md.preferred_term === 'Body mass index') {
                bmi = toNumber(md.data_value);
            }
        }
        let label = '';
        if (sex && age) {
            label += `${sex}, Age ${age}`;
            if (bmi) {
                label += `, BMI ${bmi.toFixed(1)}`;
            }
        }
        const dateEntered = new Date(donor.last_modified_timestamp).toLocaleDateString();
        const groupName = GROUP_UUID_MAPPING[donor.group_uuid] || donor.group_name;
        const creator = donor.created_by_user_displayname;
        return {
            '@id': HBM_PREFIX + donor.uuid,
            '@type': 'Donor',
            label,
            description: `Entered ${dateEntered}, ${creator}, ${groupName}`,
            link: `${portalUrl}browse/donor/${donor.uuid}`,
            age,
            sex,
            bmi,
            consortium_name: 'HuBMAP',
            provider_name: groupName,
            provider_uuid: donor.group_uuid,
            samples: []
        };
    }
    getRuiLocation(data, donor) {
        var _a;
        let spatialEntity;
        let ruiLocation = data.rui_location;
        if (ruiLocation) {
            // RUI Location may come in as an unparsed string
            if (typeof ruiLocation === 'string') {
                ruiLocation = JSON.parse(ruiLocation);
            }
            if (ruiLocation.alignment_id) { // Detect RUI 0.5 generated JSON
                console.log('Detected a deprecated rui_location', data.uuid);
            }
            else if (ruiLocation['@id']) { // Detect RUI 1.0+ generated JSON-LD
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                spatialEntity = ruiLocation;
            }
        }
        if (spatialEntity) {
            // Patch to fix RUI 0.5 Kidney and Spleen Placements
            const target = (_a = get(spatialEntity, ['placement', 'target'])) !== null && _a !== void 0 ? _a : '';
            if (target.startsWith('http://purl.org/ccf/latest/ccf.owl#VHSpleenCC')) {
                if (donor.sex === 'Male') {
                    set(spatialEntity, ['placement', 'target'], target.replace('#VHSpleenCC', '#VHMSpleenCC'));
                }
                else {
                    set(spatialEntity, ['placement', 'target'], target.replace('#VHSpleenCC', '#VHFSpleenCC'));
                }
            }
            else if (target === 'http://purl.org/ccf/latest/ccf.owl#VHLeftKidney' || target === 'http://purl.org/ccf/latest/ccf.owl#VHRightKidney') {
                if (donor.sex === 'Male') {
                    set(spatialEntity, ['placement', 'target'], target.replace('#VH', '#VHM') + '_Patch');
                }
                else {
                    set(spatialEntity, ['placement', 'target'], target.replace('#VH', '#VHF') + '_Patch');
                }
            }
        }
        return spatialEntity;
    }
    getTissueBlock() {
        return omit(Object.assign({}, this), ['data', 'bad', 'donor']);
    }
    toJsonLd() {
        return Object.assign(Object.assign({}, this.donor), { samples: [this.getTissueBlock()] });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHVibWFwLWRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jY2YtZGF0YWJhc2Uvc3JjL2xpYi9odWJtYXAvaHVibWFwLWRhdGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUlsRCxNQUFNLFVBQVUsR0FBRyxtREFBbUQsQ0FBQztBQUV2RSxtQ0FBbUM7QUFDbkMsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMscURBQXFELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsK0NBQStDLEVBQUUsc0RBQXNELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUsbURBQW1ELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUsNkNBQTZDLEVBQUUscURBQXFELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsK0NBQStDLEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsOENBQThDLEVBQUUscURBQXFELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsdURBQXVELEVBQUUseURBQXlELEVBQUUseURBQXlELEVBQUUsaURBQWlELEVBQUUsdURBQXVELEVBQUUseURBQXlELEVBQUUseURBQXlELEVBQUUsaURBQWlELEVBQUUsd0RBQXdELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUscURBQXFELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsK0NBQStDLEVBQUUsc0RBQXNELEVBQUUsd0RBQXdELEVBQUUsd0RBQXdELEVBQUUsZ0RBQWdELEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsOENBQThDLEVBQUUscURBQXFELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsd0RBQXdELEVBQUUsd0RBQXdELEVBQUUsZ0RBQWdELEVBQUUsdURBQXVELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsd0RBQXdELEVBQUUsd0RBQXdELEVBQUUsZ0RBQWdELEVBQUUsdURBQXVELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsdURBQXVELEVBQUUseURBQXlELEVBQUUseURBQXlELEVBQUUsaURBQWlELEVBQUUsc0RBQXNELEVBQUUsd0RBQXdELEVBQUUsd0RBQXdELEVBQUUsZ0RBQWdELEVBQUUscURBQXFELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsK0NBQStDLEVBQUUsc0RBQXNELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUsbURBQW1ELEVBQUUscURBQXFELEVBQUUscURBQXFELEVBQUUsNkNBQTZDLEVBQUUscURBQXFELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsK0NBQStDLEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsOENBQThDLEVBQUUscURBQXFELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsdURBQXVELEVBQUUseURBQXlELEVBQUUseURBQXlELEVBQUUsaURBQWlELEVBQUUsdURBQXVELEVBQUUseURBQXlELEVBQUUseURBQXlELEVBQUUsaURBQWlELEVBQUUsd0RBQXdELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsdURBQXVELEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsOENBQThDLEVBQUUscURBQXFELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsb0RBQW9ELEVBQUUsc0RBQXNELEVBQUUsd0RBQXdELEVBQUUsd0RBQXdELEVBQUUsZ0RBQWdELEVBQUUsdURBQXVELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELEVBQUUsc0RBQXNELENBQUMsQ0FBQyxDQUFDO0FBQ2g3TixtQ0FBbUM7QUFDbkMsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUsc0NBQXNDLEVBQUUsaUJBQWlCLEVBQUUs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YztRQUNaLE9BQU8sSUFBSSxtQkFBTSxJQUFJLEdBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUF5QixDQUFDO0lBQzdFLENBQUM7SUFFRCxRQUFRO1FBQ04sdUNBQVksSUFBSSxDQUFDLEtBQUssS0FBRSxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBRztJQUM3RCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb24gKi9cbmltcG9ydCB7IEpzb25MZCwgSnNvbkxkT2JqIH0gZnJvbSAnanNvbmxkL2pzb25sZC1zcGVjJztcbmltcG9ydCB7IGdldCwgb21pdCwgc2V0LCB0b051bWJlciB9IGZyb20gJ2xvZGFzaCc7XG5cblxudHlwZSBKc29uRGljdCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuY29uc3QgSEJNX1BSRUZJWCA9ICdodHRwczovL2VudGl0eS5hcGkuaHVibWFwY29uc29ydGl1bS5vcmcvZW50aXRpZXMvJztcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cbmV4cG9ydCBjb25zdCBEUjFfVlVfVEhVTUJTID0gbmV3IFNldChbJ1ZBTjAwMDMtTEstMzItMjEtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIxLUlNU19OZWdNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIxLUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIxLVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMi1BRl9wcmVNeElGX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIyLU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMi1NeElGX2N5YzJfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDMtTEstMzItMjItTXhJRl9jeWMzX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA1LVJLLTEtMS1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDUtUkstMS0xLUlNU19OZWdNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA1LVJLLTEtMS1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy0xLTEtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA1LVJLLTQtMTcyLUFGX3ByZUlNU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy00LTE3Mi1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy00LTE3Mi1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy00LTE3Mi1QQVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04NS1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04NS1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg1LUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA2LUxLLTItODUtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA2LUxLLTItODYtQUZfcHJlTXhJRl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg2LU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg2LU14SUZfY3ljMl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg2LU14SUZfY3ljM19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNy1MSy0yMDMtMTAzLUFGX3ByZUlNU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNy1MSy0yMDMtMTAzLUlNU19OZWdNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA3LUxLLTIwMy0xMDMtSU1TX1Bvc01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDctTEstMjAzLTEwMy1QQVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMC1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMC1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAwLUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA4LVJLLTQwMy0xMDAtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA4LVJLLTQwMy0xMDEtQUZfcHJlTXhJRl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAxLU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAxLU14SUZfY3ljMl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAxLU14SUZfY3ljM19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOS1MSy0xMDItNy1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDktTEstMTAyLTctSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDktTEstMTAyLTctSU1TX1Bvc01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDktTEstMTAyLTctUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEwLUxLLTE1NS00MC1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTAtTEstMTU1LTQwLUlNU19OZWdNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEwLUxLLTE1NS00MC1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMC1MSy0xNTUtNDAtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDExLVJLLTMtMTAtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDExLVJLLTMtMTAtSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMC1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTEwLVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTExLUFGX3ByZU14SUZfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMS1NeElGX2N5YzFfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMS1NeElGX2N5YzJfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMS1NeElGX2N5YzNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc1LUFGX3ByZUlNU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzUtSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc1LUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEyLVJLLTEwMy03NS1QQVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc2LUFGX3ByZU14SUZfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc2LU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzYtTXhJRl9jeWMyX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEyLVJLLTEwMy03Ni1NeElGX2N5YzNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTMtTEstMjAyLTk2LUFGX3ByZUlNU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMy1MSy0yMDItOTYtSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTMtTEstMjAyLTk2LUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEzLUxLLTIwMi05Ni1QQVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTMtTEstMjAyLTk3LUFGX3ByZU14SUZfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTMtTEstMjAyLTk3LU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMy1MSy0yMDItOTctTXhJRl9jeWMyX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEzLUxLLTIwMi05Ny1NeElGX2N5YzNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTQtTEstMjAzLTEwOC1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTQtTEstMjAzLTEwOC1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxNC1MSy0yMDMtMTA4LUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDE0LUxLLTIwMy0xMDgtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDE2LUxLLTIwMi04OS1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTYtTEstMjAyLTg5LUlNU19OZWdNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDE2LUxLLTIwMi04OS1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxNi1MSy0yMDItODktUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIxLUFGX3ByZUlNU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMS1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMS1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMS1QQVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDMtTEstMzItMjItQUZfcHJlTXhJRl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwMy1MSy0zMi0yMi1NeElGX2N5YzFfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDMtTEstMzItMjItTXhJRl9jeWMyX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDAzLUxLLTMyLTIyLU14SUZfY3ljM19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy0xLTEtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA1LVJLLTEtMS1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy0xLTEtSU1TX1Bvc01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDUtUkstMS0xLVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNS1SSy00LTE3Mi1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDUtUkstNC0xNzItSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDUtUkstNC0xNzItSU1TX1Bvc01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDUtUkstNC0xNzItUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA2LUxLLTItODUtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA2LUxLLTItODUtSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04NS1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg1LVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNi1MSy0yLTg2LUFGX3ByZU14SUZfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04Ni1NeElGX2N5YzFfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04Ni1NeElGX2N5YzJfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDYtTEstMi04Ni1NeElGX2N5YzNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDctTEstMjAzLTEwMy1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDctTEstMjAzLTEwMy1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwNy1MSy0yMDMtMTAzLUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA3LUxLLTIwMy0xMDMtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA4LVJLLTQwMy0xMDAtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDA4LVJLLTQwMy0xMDAtSU1TX05lZ01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMC1JTVNfUG9zTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAwLVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAwOC1SSy00MDMtMTAxLUFGX3ByZU14SUZfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMS1NeElGX2N5YzFfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMS1NeElGX2N5YzJfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMDgtUkstNDAzLTEwMS1NeElGX2N5YzNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMC1BRl9wcmVJTVNfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTEtUkstMy0xMC1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTEwLUlNU19Qb3NNb2RlX211bHRpbGF5ZXJfdGh1bWJuYWlsLmpwZycsICdWQU4wMDExLVJLLTMtMTAtUEFTX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDExLVJLLTMtMTEtQUZfcHJlTXhJRl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTExLU14SUZfY3ljMV9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTExLU14SUZfY3ljMl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMS1SSy0zLTExLU14SUZfY3ljM19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzUtQUZfcHJlSU1TX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEyLVJLLTEwMy03NS1JTVNfTmVnTW9kZV9tdWx0aWxheWVyX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzUtSU1TX1Bvc01vZGVfbXVsdGlsYXllcl90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc1LVBBU19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzYtQUZfcHJlTXhJRl9yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnLCAnVkFOMDAxMi1SSy0xMDMtNzYtTXhJRl9jeWMxX3JlZ2lzdGVyZWRfdGh1bWJuYWlsLmpwZycsICdWQU4wMDEyLVJLLTEwMy03Ni1NeElGX2N5YzJfcmVnaXN0ZXJlZF90aHVtYm5haWwuanBnJywgJ1ZBTjAwMTItUkstMTAzLTc2LU14SUZfY3ljM19yZWdpc3RlcmVkX3RodW1ibmFpbC5qcGcnXSk7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuZXhwb3J0IGNvbnN0IFVGTF9USFVNQlMgPSB7ICdIQk01NTguU1JaRy42MjknOiAnSEJNNTU4LlNSWkcuNjI5X1VGTDAwMDItU1AtMy00LTEuanBnJywgJ0hCTTU2Mi5OVE1ILjU0OCc6ICdIQk01NjIuTlRNSC41NDhfVUZMMDAwNi1TUC0xLTItMS5qcGcnLCAnSEJNNjg1LktIUlEuNjg0JzogJ0hCTTY4NS5LSFJRLjY4NF9VRkwwMDA4LUxZMDctMS0xLmpwZycsICdIQk0yNzguU0ZRVy42MjcnOiAnSEJNMjc4LlNGUVcuNjI3X1VGTDAwMDgtTFkwOS0xLTEuanBnJywgJ0hCTTQyNy5TTUdCLjg2Nic6ICdIQk00MjcuU01HQi44NjZfVUZMMDAwNC1TUC0xLTQtMS5qcGcnLCAnSEJNNDMyLkxMQ0YuNjc3JzogJ0hCTTQzMi5MTENGLjY3N19VRkwwMDAxLVNQLTItNS0xLmpwZycsICdIQk01ODYuWlNWUy45OTYnOiAnSEJNNTg2LlpTVlMuOTk2X1VGTDAwMDgtU1AtMS0xLTEuanBnJywgJ0hCTTI4NS5YTUJULjU0Mic6ICdIQk0yODUuWE1CVC41NDJfVUZMMDAwNi1USC0xLTMtMS5qcGcnLCAnSEJNMjg5LkJXSlcuNjYzJzogJ0hCTTI4OS5CV0pXLjY2M19VRkwwMDA2LVRILTEtMi0xLmpwZycsICdIQk0yNTUuU1JQUi45ODUnOiAnSEJNMjU1LlNSUFIuOTg1X1VGTDAwMDUtVEgtMi0yLTEuanBnJywgJ0hCTTc5OS5XWEhELjUzNSc6ICdIQk03OTkuV1hIRC41MzVfVUZMMDAwOS1MWTAyLTEtMS5qcGcnLCAnSEJNMjk0LlJaRk4uNjI0JzogJ0hCTTI5NC5SWkZOLjYyNF9VRkwwMDA1LVRILTEtMS0xLmpwZycsICdIQk0zODMuVFJRRy40MjQnOiAnSEJNMzgzLlRSUUcuNDI0X1VGTDAwMDYtU1AtMS0zLTEuanBnJywgJ0hCTTY0Ny5NRlFCLjQ5Nic6ICdIQk02NDcuTUZRQi40OTZfVUZMMDAwMS1TUC0xLTItMS5qcGcnLCAnSEJNMjM3LkdHUFIuNzM5JzogJ0hCTTIzNy5HR1BSLjczOV9VRkwwMDA2LUxZMDEtMS0xLmpwZycsICdIQk0yODguVFBCRC42NTQnOiAnSEJNMjg4LlRQQkQuNjU0X1VGTDAwMDMtU1AtMi0yLTEuanBnJywgJ0hCTTk3NC5ORFhULjY3NSc6ICdIQk05NzQuTkRYVC42NzVfVUZMMDAwOC1USC0yLTItMS5qcGcnLCAnSEJNNTg5LlNMVlYuNDIzJzogJ0hCTTU4OS5TTFZWLjQyM19VRkwwMDA4LUxZMTAtMS0xLmpwZycsICdIQk03OTQuUkxGTi4zNTgnOiAnSEJNNzk0LlJMRk4uMzU4X1VGTDAwMDYtTFkwMy0xLTEuanBnJywgJ0hCTTM3Mi5CUVNSLjc3OCc6ICdIQk0zNzIuQlFTUi43NzhfVUZMMDAwNy1TUC0xLTEtMS5qcGcnLCAnSEJNNDk5LlRLRFcuNDU4JzogJ0hCTTQ5OS5US0RXLjQ1OF9VRkwwMDA5LUxZMDMtMS0xLmpwZycsICdIQk0zNDIuUFJRQi43MzknOiAnSEJNMzQyLlBSUUIuNzM5X1VGTDAwMDMtTFkwNi0xLTEuanBnJywgJ0hCTTYzMy5DTFZOLjY3NCc6ICdIQk02MzMuQ0xWTi42NzRfVUZMMDAwMy1TUC0zLTYtMS5qcGcnLCAnSEJNMzQzLkpRS00uNTc4JzogJ0hCTTM0My5KUUtNLjU3OF9VRkwwMDA5LUxZMDEtMS0xLmpwZycsICdIQk05ODcuWEdUSC4zNjgnOiAnSEJNOTg3LlhHVEguMzY4X1VGTDAwMDItU1AtMi00LTEuanBnJywgJ0hCTTk2NC5DV0NQLjc4OCc6ICdIQk05NjQuQ1dDUC43ODhfVUZMMDAwNi1MWTAyLTItMS5qcGcnLCAnSEJNMjQ0LlRKTEsuMjIzJzogJ0hCTTI0NC5USkxLLjIyM19VRkwwMDAzLVNQLTEtNC0xLmpwZycsICdIQk02NDYuRlNCUS45NjYnOiAnSEJNNjQ2LkZTQlEuOTY2X1VGTDAwMDctU1AtMi0yLTEuanBnJywgJ0hCTTU3Mi5HWFNCLjIzNCc6ICdIQk01NzIuR1hTQi4yMzRfVUZMMDAwMy1TUC0zLTItMS5qcGcnLCAnSEJNNzcyLlRLR0ouNzk0JzogJ0hCTTc3Mi5US0dKLjc5NF9VRkwwMDA4LVNQLTItMS0xLmpwZycsICdIQk0yMzkuQ0JXUi4yNjMnOiAnSEJNMjM5LkNCV1IuMjYzX1VGTDAwMDgtU1AtMS0yLTEuanBnJywgJ0hCTTk5Mi5OUlRULjM4Myc6ICdIQk05OTIuTlJUVC4zODNfVUZMMDAwNi1TUC0xLTEtMS5qcGcnLCAnSEJNMjgzLkRRWEQuNTQ2JzogJ0hCTTI4My5EUVhELjU0Nl9VRkwwMDAzLVNQLTEtMi0xLmpwZycsICdIQk03OTUuSkhORC44NTYnOiAnSEJNNzk1LkpITkQuODU2X1VGTDAwMDctU1AtMS0yLTEuanBnJywgJ0hCTTI2Ny5CWktULjg2Nyc6ICdIQk0yNjcuQlpLVC44NjdfVUZMMDAwMy1TUC0yLTYtMS5qcGcnLCAnSEJNODM4LkRMTUouNzgyJzogJ0hCTTgzOC5ETE1KLjc4Ml9VRkwwMDA4LVRILTEtMS0xLmpwZycsICdIQk0zMzcuRlNYTC41NjQnOiAnSEJNMzM3LkZTWEwuNTY0X1VGTDAwMDEtU1AtMy04LTIuanBnJywgJ0hCTTM1NS5KRExLLjI0NCc6ICdIQk0zNTUuSkRMSy4yNDRfVUZMMDAwNC1TUC0yLTQtMS5qcGcnLCAnSEJNNTk5LlBTWkcuNzM3JzogJ0hCTTU5OS5QU1pHLjczN19VRkwwMDA2LUxZMDItMS0xLmpwZycgfTtcblxuLyoqIFVVSUQgdG8gVE1DIG1hcHBpbmcuICovXG5jb25zdCBHUk9VUF9VVUlEX01BUFBJTkc6IHsgW3V1aWQ6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAnMDNiM2Q4NTQtZWQ0NC0xMWU4LThiY2UtMGUzNjhmMzA3NWU4JzogJ1RNQy1VQ1NEJyxcbiAgJzA3YTI5ZTRjLWVkNDMtMTFlOC1iNTZhLTBlODAxN2JkZGE1OCc6ICdUTUMtRmxvcmlkYScsXG4gICczMDhmNWZmYy1lZDQzLTExZTgtYjU2YS0wZTgwMTdiZGRhNTgnOiAnVE1DLUNhbFRlY2gnLFxuICAnNWJkMDg0YzgtZWRjMi0xMWU4LTgwMmYtMGUzNjhmMzA3NWU4JzogJ0hCTS1UZXN0aW5nR3JvdXAnLFxuICAnNzNiYjI2ZTQtZWQ0My0xMWU4LThmMTktMGE3YzFlYWIwMDdhJzogJ1RNQy1WYW5kZXJiaWx0JyxcbiAgJ2RlZjVmZDc2LWVkNDMtMTFlOC1iNTZhLTBlODAxN2JkZGE1OCc6ICdUTUMtU3RhbmZvcmQnLFxuICAnNWMxMDZmMjktZWEyZC0xMWU5LTg1ZTgtMGVmYjNiYTlhNjcwJzogJ1JUSS1HZW5lcmFsIEVsZWN0cmljJyxcbiAgJzMwMTYxNWY5LWM4NzAtMTFlYi1hOGRjLTM1Y2UzZDg3ODZmZSc6ICdUTUMtVUNvbm4nXG59O1xuXG5jb25zdCBFTlRJVFlfQ09OVEVYVCA9IHtcbiAgJ0BiYXNlJzogJ2h0dHA6Ly9wdXJsLm9yZy9jY2YvbGF0ZXN0L2NjZi1lbnRpdHkub3dsIycsXG4gICdAdm9jYWInOiAnaHR0cDovL3B1cmwub3JnL2NjZi9sYXRlc3QvY2NmLWVudGl0eS5vd2wjJyxcbiAgY2NmOiAnaHR0cDovL3B1cmwub3JnL2NjZi8nLFxuICByZGZzOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMC8wMS9yZGYtc2NoZW1hIycsXG5cbiAgbGFiZWw6ICdyZGZzOmxhYmVsJyxcbiAgZGVzY3JpcHRpb246ICdyZGZzOmNvbW1lbnQnLFxuICBsaW5rOiB7XG4gICAgJ0BpZCc6ICdyZGZzOnNlZUFsc28nLFxuICAgICdAdHlwZSc6ICdAaWQnXG4gIH0sXG4gIHNhbXBsZXM6IHtcbiAgICAnQHJldmVyc2UnOiAnaGFzX2Rvbm9yJ1xuICB9LFxuICBzZWN0aW9uczoge1xuICAgICdAaWQnOiAnaGFzX3Rpc3N1ZV9zZWN0aW9uJyxcbiAgICAnQHR5cGUnOiAnQGlkJ1xuICB9LFxuICBkYXRhc2V0czoge1xuICAgICdAaWQnOiAnaGFzX2RhdGFzZXQnLFxuICAgICdAdHlwZSc6ICdAaWQnXG4gIH0sXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbiAgcnVpX2xvY2F0aW9uOiB7XG4gICAgJ0BpZCc6ICdoYXNfc3BhdGlhbF9lbnRpdHknLFxuICAgICdAdHlwZSc6ICdAaWQnXG4gIH0sXG4gIG9udG9sb2d5VGVybXM6IHtcbiAgICAnQGlkJzogJ2hhc19vbnRvbG9neV90ZXJtJyxcbiAgICAnQHR5cGUnOiAnQGlkJ1xuICB9LFxuICBjZWxsVHlwZVRlcm1zOiB7XG4gICAgJ0BpZCc6ICdoYXNfY2VsbF90eXBlX3Rlcm0nLFxuICAgICdAdHlwZSc6ICdAaWQnXG4gIH0sXG4gIHRodW1ibmFpbDoge1xuICAgICdAaWQnOiAnaGFzX3RodW1ibmFpbCdcbiAgfVxufTtcblxuLyoqXG4gKiBDb252ZXJ0cyBhIGh1Ym1hcCByZXNwb25zZSBvYmplY3QgaW50byBKc29uTGQuXG4gKlxuICogQHBhcmFtIGRhdGEgVGhlIGh1Ym1hcCBkYXRhLlxuICogQHJldHVybnMgVGhlIGNvbnZlcnRlZCBkYXRhLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaHVibWFwUmVzcG9uc2VBc0pzb25MZChkYXRhOiB1bmtub3duLCBhc3NldHNBcGkgPSAnJywgcG9ydGFsVXJsID0gJycsIHNlcnZpY2VUb2tlbj86IHN0cmluZywgZGVidWcgPSBmYWxzZSk6IEpzb25MZCB7XG4gIGNvbnN0IGVudHJpZXMgPSAoZ2V0KGRhdGEsICdoaXRzLmhpdHMnLCBbXSkgYXMgSnNvbkRpY3RbXSlcbiAgICAubWFwKGUgPT4gZ2V0KGUsICdfc291cmNlJywge30pIGFzIEpzb25EaWN0KVxuICAgIC5zb3J0KChhLCBiKSA9PiAoYVsndXVpZCddIGFzIHN0cmluZykubG9jYWxlQ29tcGFyZShiWyd1dWlkJ10gYXMgc3RyaW5nKSk7XG5cbiAgY29uc3QgZG9ub3JMb29rdXA6IFJlY29yZDxzdHJpbmcsIEpzb25MZE9iaj4gPSB7fTtcbiAgY29uc3QgdW5mbGF0dGVuZWQ6IEpzb25MZE9ialtdID0gZW50cmllcy5tYXAoZSA9PlxuICAgIG5ldyBIdUJNQVBUaXNzdWVCbG9jayhlLCBhc3NldHNBcGksIHBvcnRhbFVybCwgc2VydmljZVRva2VuKS50b0pzb25MZCgpXG4gICk7XG4gIGZvciAoY29uc3QgZG9ub3Igb2YgdW5mbGF0dGVuZWQpIHtcbiAgICBjb25zdCBkb25vcklkID0gZG9ub3JbJ0BpZCddIGFzIHN0cmluZztcbiAgICBpZiAoIWRvbm9yTG9va3VwW2Rvbm9ySWRdKSB7XG4gICAgICBkb25vckxvb2t1cFtkb25vcklkXSA9IGRvbm9yO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzYW1wbGVzID0gZG9ub3JMb29rdXBbZG9ub3JJZF0uc2FtcGxlcyBhcyBKc29uTGRPYmpbXTtcbiAgICAgIHNhbXBsZXMucHVzaCgoZG9ub3Iuc2FtcGxlcyBhcyBKc29uTGRPYmpbXSlbMF0pO1xuICAgIH1cbiAgfVxuICBjb25zdCBkb25vcnMgPSBPYmplY3QudmFsdWVzKGRvbm9yTG9va3VwKTtcblxuICBpZiAoZGVidWcpIHtcbiAgICBkZWJ1Z0Rvbm9ycyhkb25vcnMpO1xuICAgIGNvbnNvbGUubG9nKGRvbm9ycy5tYXAoZCA9PiAoeyAnQGNvbnRleHQnOiBFTlRJVFlfQ09OVEVYVCwgLi4uZCB9KSkpO1xuICB9XG5cbiAgcmV0dXJuIHsgJ0Bjb250ZXh0JzogRU5USVRZX0NPTlRFWFQsICdAZ3JhcGgnOiBkb25vcnMgfTtcbn1cblxuZnVuY3Rpb24gZGVidWdEb25vcnMoZG9ub3JzOiBKc29uTGRPYmpbXSkge1xuICBsZXQgZGF0YXNldHM6IEpzb25MZE9ialtdID0gW107XG4gIGxldCBkZWxldGVkID0gMDtcbiAgZm9yIChjb25zdCBkb25vciBvZiBkb25vcnMuZmlsdGVyKGQgPT4gKGQuc2FtcGxlcyBhcyBbXSkubGVuZ3RoID4gMSkpIHtcbiAgICBjb25zdCBzYW1wbGVzID0gZG9ub3Iuc2FtcGxlcyBhcyBKc29uTGRPYmpbXTtcbiAgICBmb3IgKGxldCBpPTA7IGkgPCBzYW1wbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBibG9ja0lkID0gc2FtcGxlc1tpXVsnQGlkJ10gYXMgc3RyaW5nO1xuICAgICAgZGF0YXNldHMgPSBkYXRhc2V0cy5jb25jYXQoc2FtcGxlc1tpXS5kYXRhc2V0cyBhcyBKc29uTGRPYmpbXSk7XG4gICAgICBmb3IgKGNvbnN0IHNlY3Rpb24gb2Ygc2FtcGxlc1tpXS5zZWN0aW9ucyBhcyBKc29uTGRPYmpbXSkge1xuICAgICAgICBkYXRhc2V0cyA9IGRhdGFzZXRzLmNvbmNhdChzZWN0aW9uLmRhdGFzZXRzIGFzIEpzb25MZE9ialtdKTtcbiAgICAgIH1cbiAgICAgIGZvciAobGV0IGo9aSsxOyBqIDwgc2FtcGxlcy5sZW5ndGg7IGorKykge1xuICAgICAgICBjb25zdCBzZWN0aW9ucyA9IHNhbXBsZXNbal0uc2VjdGlvbnMgYXMgSnNvbkxkT2JqW107XG4gICAgICAgIGlmIChzZWN0aW9ucy5maW5kKHMgPT4gc1snQGlkJ10gPT09IGJsb2NrSWQpKSB7XG4gICAgICAgICAgc2FtcGxlc1tpXS5kZWxldGVNZSA9IHRydWU7XG4gICAgICAgICAgZGVsZXRlZCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRvbm9yLnNhbXBsZXMgPSBzYW1wbGVzLmZpbHRlcihzID0+IHMuZGVsZXRlTWUgIT09IHRydWUpO1xuICB9XG4gIGlmIChkZWxldGVkID4gMCkge1xuICAgIGNvbnNvbGUubG9nKGDimqAgJHtkZWxldGVkfSBzZWN0aW9ucyBpZGVudGlmaWVkIGFzIGJsb2Nrc2ApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBIdUJNQVBUaXNzdWVCbG9jayB7XG4gIGJhZCA9IGZhbHNlO1xuICBkb25vcjogSnNvbkxkT2JqO1xuXG4gICdAaWQnOiBzdHJpbmc7XG4gICdAdHlwZScgPSAnU2FtcGxlJztcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgbGluazogc3RyaW5nO1xuXG4gIHNhbXBsZV90eXBlID0gJ1Rpc3N1ZSBCbG9jayc7XG4gIHNlY3Rpb25fY291bnQ6IG51bWJlcjtcbiAgc2VjdGlvbl9zaXplOiBudW1iZXI7XG4gIHNlY3Rpb25fdW5pdHM6IHN0cmluZztcblxuICBydWlfbG9jYXRpb246IEpzb25MZE9iajtcbiAgc2VjdGlvbnM6IEpzb25MZE9ialtdO1xuICBkYXRhc2V0czogSnNvbkxkT2JqW107XG5cbiAgY29uc3RydWN0b3IocHVibGljIGRhdGE6IEpzb25EaWN0LCBhc3NldHNBcGkgPSAnJywgcG9ydGFsVXJsID0gJycsIHNlcnZpY2VUb2tlbj86IHN0cmluZykge1xuICAgIGNvbnN0IGVudGl0eVR5cGUgPSB0aGlzLmRhdGEuZW50aXR5X3R5cGU7XG4gICAgaWYgKGVudGl0eVR5cGUgIT09ICdTYW1wbGUnKSB7XG4gICAgICB0aGlzLmJhZCA9IHRydWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGFuY2VzdG9ycyA9ICh0aGlzLmRhdGEuYW5jZXN0b3JzIHx8IFtdKSBhcyBKc29uRGljdFtdO1xuICAgIGNvbnN0IGRlc2NlbmRhbnRzID0gKHRoaXMuZGF0YS5kZXNjZW5kYW50cyB8fCBbXSkgYXMgSnNvbkRpY3RbXTtcblxuICAgIGNvbnN0IGRvbm9yID0gYW5jZXN0b3JzLmZpbmQoZSA9PiBlLmVudGl0eV90eXBlID09PSAnRG9ub3InKSBhcyBKc29uRGljdDtcbiAgICB0aGlzLmRvbm9yID0gdGhpcy5nZXREb25vcihkb25vciwgcG9ydGFsVXJsKTtcbiAgICBjb25zdCBydWlMb2NhdGlvbiA9IHRoaXMuZ2V0UnVpTG9jYXRpb24oZGF0YSwgdGhpcy5kb25vcik7XG4gICAgaWYgKCFydWlMb2NhdGlvbikge1xuICAgICAgdGhpcy5iYWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJ1aV9sb2NhdGlvbiA9IHJ1aUxvY2F0aW9uO1xuICAgIH1cblxuICAgIGlmICghR1JPVVBfVVVJRF9NQVBQSU5HW2RhdGEuZ3JvdXBfdXVpZCBhcyBzdHJpbmddKSB7XG4gICAgICBHUk9VUF9VVUlEX01BUFBJTkdbZGF0YS5ncm91cF91dWlkIGFzIHN0cmluZ10gPSBkYXRhLmdyb3VwX25hbWUgYXMgc3RyaW5nO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGVFbnRlcmVkID0gbmV3IERhdGUoZGF0YS5sYXN0X21vZGlmaWVkX3RpbWVzdGFtcCBhcyBudW1iZXIpLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xuICAgIGNvbnN0IGdyb3VwTmFtZSA9IEdST1VQX1VVSURfTUFQUElOR1tkYXRhLmdyb3VwX3V1aWQgYXMgc3RyaW5nXSB8fCBkYXRhLmdyb3VwX25hbWUgYXMgc3RyaW5nO1xuICAgIGNvbnN0IGNyZWF0b3IgPSBkYXRhLmNyZWF0ZWRfYnlfdXNlcl9kaXNwbGF5bmFtZTtcblxuICAgIHRoaXNbJ0BpZCddID0gSEJNX1BSRUZJWCArIGRhdGEudXVpZDtcbiAgICB0aGlzLmxhYmVsID0gYFJlZ2lzdGVyZWQgJHtkYXRlRW50ZXJlZH0sICR7Y3JlYXRvcn0sICR7Z3JvdXBOYW1lfWA7XG4gICAgdGhpcy5saW5rID0gYCR7cG9ydGFsVXJsfWJyb3dzZS9zYW1wbGUvJHtkYXRhLnV1aWR9YDtcblxuICAgIGNvbnN0IHNlY3Rpb25Mb29rdXA6IFJlY29yZDxzdHJpbmcsIEpzb25MZE9iaj4gPSB7fTtcbiAgICBjb25zdCBzZWN0aW9uczogSnNvbkxkT2JqW10gPSBbXTtcbiAgICB0aGlzLnNlY3Rpb25zID0gc2VjdGlvbnM7XG4gICAgY29uc3QgZGF0YXNldHM6IEpzb25MZE9ialtdID0gW107XG4gICAgdGhpcy5kYXRhc2V0cyA9IGRhdGFzZXRzO1xuXG4gICAgZm9yIChjb25zdCBkZXNjZW5kYW50IG9mIGRlc2NlbmRhbnRzLmZpbHRlcihkID0+IGQuZW50aXR5X3R5cGUgPT09ICdTYW1wbGUnKSkge1xuICAgICAgY29uc3Qgc2VjdGlvbiA9IHRoaXMuZ2V0U2VjdGlvbihkZXNjZW5kYW50LCBkYXRhLCBwb3J0YWxVcmwpO1xuXG4gICAgICBjb25zdCBzZWN0aW9uSWQgPSBkZXNjZW5kYW50LnN1Ym1pc3Npb25faWQgYXMgc3RyaW5nO1xuICAgICAgc2VjdGlvbkxvb2t1cFtzZWN0aW9uSWRdID0gc2VjdGlvbjtcbiAgICAgIHNlY3Rpb25zLnB1c2goc2VjdGlvbik7XG4gICAgICBzZWN0aW9uLnNlY3Rpb25fbnVtYmVyID0gc2VjdGlvbi5zZWN0aW9uX251bWJlciA/PyBzZWN0aW9ucy5sZW5ndGg7XG4gICAgfVxuICAgIGZvciAoY29uc3QgZGVzY2VuZGFudCBvZiBkZXNjZW5kYW50cykge1xuICAgICAgaWYgKGRlc2NlbmRhbnQuZW50aXR5X3R5cGUgPT09ICdEYXRhc2V0Jykge1xuICAgICAgICBjb25zdCBkYXRhc2V0ID0gdGhpcy5nZXREYXRhc2V0KGRlc2NlbmRhbnQsIGFzc2V0c0FwaSwgcG9ydGFsVXJsLCBzZXJ2aWNlVG9rZW4pO1xuXG4gICAgICAgIGNvbnN0IHNlY3Rpb25JZCA9IGdldChkZXNjZW5kYW50LCBbJ2luZ2VzdF9tZXRhZGF0YScsICdtZXRhZGF0YScsICd0aXNzdWVfaWQnXSkgYXMgc3RyaW5nO1xuICAgICAgICBpZiAoc2VjdGlvbkxvb2t1cFtzZWN0aW9uSWRdKSB7XG4gICAgICAgICAgKHNlY3Rpb25Mb29rdXBbc2VjdGlvbklkXS5kYXRhc2V0cyBhcyBKc29uTGRbXSk/LnB1c2goZGF0YXNldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0YXNldHMucHVzaChkYXRhc2V0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGxvYzogSnNvbkRpY3QgPSBydWlMb2NhdGlvbiA/PyB7fTtcbiAgICBjb25zdCBkaW1zID0gYCR7bG9jLnhfZGltZW5zaW9ufSB4ICR7bG9jLnlfZGltZW5zaW9ufSB4ICR7bG9jLnpfZGltZW5zaW9ufSAke2xvYy5kaW1lbnNpb25fdW5pdHN9YDtcbiAgICB0aGlzLnNlY3Rpb25fY291bnQgPSBsb2Muc2xpY2VfY291bnQgYXMgbnVtYmVyIHx8IHNlY3Rpb25zLmxlbmd0aDtcbiAgICBjb25zdCBzU2l6ZSA9IHBhcnNlRmxvYXQoXG4gICAgICAobG9jLnNsaWNlX3RoaWNrbmVzcyBhcyBudW1iZXIgfHxcbiAgICAgICAgKChsb2Muel9kaW1lbnNpb24gYXMgbnVtYmVyIHx8IDApIC8gTWF0aC5tYXgodGhpcy5zZWN0aW9uX2NvdW50LCAxKSkpXG4gICAgICAgIC50b0ZpeGVkKDEpXG4gICAgKTtcbiAgICB0aGlzLnNlY3Rpb25fc2l6ZSA9IHNTaXplO1xuICAgIGNvbnN0IHNVbml0cyA9IGxvYy5kaW1lbnNpb25fdW5pdHMgYXMgc3RyaW5nIHx8ICdtaWxsaW1ldGVyJztcbiAgICB0aGlzLnNlY3Rpb25fdW5pdHMgPSBzVW5pdHM7XG5cbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gYCR7ZGltc30sICR7c1NpemV9ICR7c1VuaXRzfSwgJHtkYXRhLnNwZWNpbWVuX3R5cGV9LCAke3RoaXMuc2VjdGlvbl9jb3VudH0gU2VjdGlvbnNgO1xuXG4gICAgc2VjdGlvbnMuZm9yRWFjaCgoc2VjdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgIHNlY3Rpb24uZGVzY3JpcHRpb24gPSBgJHtsb2MueF9kaW1lbnNpb259IHggJHtsb2MueV9kaW1lbnNpb259IHggJHtzU2l6ZX0gJHtzVW5pdHN9LCAke3NTaXplfSAke3NVbml0c30sICR7c2VjdGlvbi5kZXNjcmlwdGlvbn1gO1xuICAgICAgc2VjdGlvbi5zZWN0aW9uX251bWJlciA9IGluZGV4ICsgMTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNlY3Rpb24oc2VjdGlvbjogSnNvbkRpY3QsIGRhdGE6IEpzb25EaWN0LCBwb3J0YWxVcmw6IHN0cmluZyk6IEpzb25MZE9iaiB7XG4gICAgY29uc3QgZGF0ZUVudGVyZWQgPSBuZXcgRGF0ZShzZWN0aW9uLmxhc3RfbW9kaWZpZWRfdGltZXN0YW1wIGFzIG51bWJlcikudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG4gICAgY29uc3QgZ3JvdXBOYW1lID0gR1JPVVBfVVVJRF9NQVBQSU5HW3NlY3Rpb24uZ3JvdXBfdXVpZCBhcyBzdHJpbmddIHx8IHNlY3Rpb24uZ3JvdXBfbmFtZSBhcyBzdHJpbmc7XG4gICAgY29uc3QgY3JlYXRvciA9IHNlY3Rpb24uY3JlYXRlZF9ieV91c2VyX2Rpc3BsYXluYW1lO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICdAaWQnOiBIQk1fUFJFRklYICsgc2VjdGlvbi51dWlkLFxuICAgICAgJ0B0eXBlJzogJ1NhbXBsZScsXG4gICAgICBsYWJlbDogYFJlZ2lzdGVyZWQgJHtkYXRlRW50ZXJlZH0sICR7Y3JlYXRvcn0sICR7Z3JvdXBOYW1lfWAsXG4gICAgICBkZXNjcmlwdGlvbjogYCR7ZGF0YS5zcGVjaW1lbl90eXBlfWAsXG4gICAgICBsaW5rOiBgJHtwb3J0YWxVcmx9YnJvd3NlL3NhbXBsZS8ke3NlY3Rpb24udXVpZH1gLFxuXG4gICAgICBzYW1wbGVfdHlwZTogJ1Rpc3N1ZSBTZWN0aW9uJyxcbiAgICAgIHNlY3Rpb25fbnVtYmVyOiAxLFxuXG4gICAgICBzYW1wbGVzOiBbXSxcbiAgICAgIGRhdGFzZXRzOiBbXVxuICAgIH07XG4gIH1cblxuICBnZXREYXRhc2V0KGRhdGFzZXQ6IEpzb25EaWN0LCBhc3NldHNBcGkgPSAnJywgcG9ydGFsVXJsID0gJycsIHNlcnZpY2VUb2tlbj86IHN0cmluZyk6IEpzb25MZE9iaiB7XG4gICAgY29uc3QgZGF0ZUVudGVyZWQgPSBuZXcgRGF0ZShkYXRhc2V0Lmxhc3RfbW9kaWZpZWRfdGltZXN0YW1wIGFzIG51bWJlcikudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG4gICAgY29uc3QgZ3JvdXBOYW1lID0gR1JPVVBfVVVJRF9NQVBQSU5HW2RhdGFzZXQuZ3JvdXBfdXVpZCBhcyBzdHJpbmddIHx8IGRhdGFzZXQuZ3JvdXBfbmFtZSBhcyBzdHJpbmc7XG4gICAgY29uc3QgY3JlYXRvciA9IGRhdGFzZXQuY3JlYXRlZF9ieV91c2VyX2Rpc3BsYXluYW1lO1xuXG4gICAgY29uc3QgdHlwZXMgPSBbXG4gICAgICAuLi5kYXRhc2V0LmRhdGFfdHlwZXMgYXMgc3RyaW5nW10sXG4gICAgICBnZXQoZGF0YXNldCwgWydpbmdlc3RfbWV0YWRhdGEnLCAnbWV0YWRhdGEnLCAnYXNzYXlfdHlwZSddLCAnJylcbiAgICBdO1xuICAgIGNvbnN0IHR5cGVzU2VhcmNoID0gdHlwZXMuam9pbignfCcpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBsZXQgdGVjaG5vbG9neTogc3RyaW5nO1xuICAgIGxldCB0aHVtYm5haWwgPSAnYXNzZXRzL2ljb25zL2ljby11bmtub3duLnN2Zyc7XG4gICAgaWYgKHR5cGVzU2VhcmNoLmluZGV4T2YoJzEweCcpICE9PSAtMSkge1xuICAgICAgdGVjaG5vbG9neSA9ICcxMHgnO1xuICAgICAgdGh1bWJuYWlsID0gJ2Fzc2V0cy9pY29ucy9pY28tYnVsay0xMHguc3ZnJztcbiAgICB9IGVsc2UgaWYgKHR5cGVzU2VhcmNoLmluZGV4T2YoJ2FmJykgIT09IC0xKSB7XG4gICAgICB0ZWNobm9sb2d5ID0gJ0FGJztcbiAgICAgIHRodW1ibmFpbCA9ICdhc3NldHMvaWNvbnMvaWNvLXNwYXRpYWwtYWYuc3ZnJztcbiAgICB9IGVsc2UgaWYgKHR5cGVzU2VhcmNoLmluZGV4T2YoJ2NvZGV4JykgIT09IC0xKSB7XG4gICAgICB0ZWNobm9sb2d5ID0gJ0NPREVYJztcbiAgICAgIHRodW1ibmFpbCA9ICdhc3NldHMvaWNvbnMvaWNvLXNwYXRpYWwtY29kZXguc3ZnJztcbiAgICB9IGVsc2UgaWYgKHR5cGVzU2VhcmNoLmluZGV4T2YoJ2ltYycpICE9PSAtMSkge1xuICAgICAgdGVjaG5vbG9neSA9ICdJTUMnO1xuICAgICAgdGh1bWJuYWlsID0gJ2Fzc2V0cy9pY29ucy9pY28tc3BhdGlhbC1pbWMuc3ZnJztcbiAgICB9IGVsc2UgaWYgKCh0eXBlc1NlYXJjaC5pbmRleE9mKCdsYycpICE9PSAtMSkgJiYgKHR5cGVzU2VhcmNoLmluZGV4T2YoJ2FmJykgPT09IC0xKSkge1xuICAgICAgdGVjaG5vbG9neSA9ICdMQyc7XG4gICAgICB0aHVtYm5haWwgPSAnYXNzZXRzL2ljb25zL2ljby1idWxrLWxjLnN2Zyc7XG4gICAgfSBlbHNlIGlmICh0eXBlc1NlYXJjaC5pbmRleE9mKCdtYWxkaScpICE9PSAtMSkge1xuICAgICAgdGVjaG5vbG9neSA9ICdNQUxESSc7XG4gICAgfSBlbHNlIGlmICh0eXBlc1NlYXJjaC5pbmRleE9mKCdwYXMnKSAhPT0gLTEpIHtcbiAgICAgIHRlY2hub2xvZ3kgPSAnUEFTJztcbiAgICB9IGVsc2Uge1xuICAgICAgdGVjaG5vbG9neSA9ICdPVEhFUic7XG4gICAgfVxuICAgIHRodW1ibmFpbCA9IHRoaXMuZ2V0RGF0YXNldFRodW1ibmFpbChkYXRhc2V0LCBhc3NldHNBcGksIHNlcnZpY2VUb2tlbikgPz8gdGh1bWJuYWlsO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICdAaWQnOiBIQk1fUFJFRklYICsgZGF0YXNldC51dWlkLFxuICAgICAgJ0B0eXBlJzogJ0RhdGFzZXQnLFxuICAgICAgbGFiZWw6IGBSZWdpc3RlcmVkICR7ZGF0ZUVudGVyZWR9LCAke2NyZWF0b3J9LCAke2dyb3VwTmFtZX1gLFxuICAgICAgZGVzY3JpcHRpb246IGBEYXRhL0Fzc2F5IFR5cGVzOiAke3R5cGVzLmpvaW4oJywgJyl9YCxcbiAgICAgIGxpbms6IGAke3BvcnRhbFVybH1icm93c2UvZGF0YXNldC8ke2RhdGFzZXQudXVpZH1gLFxuICAgICAgdGVjaG5vbG9neSxcbiAgICAgIHRodW1ibmFpbFxuICAgIH07XG4gIH1cblxuICBnZXREYXRhc2V0VGh1bWJuYWlsKGRhdGFzZXQ6IEpzb25EaWN0LCBhc3NldHNBcGk6IHN0cmluZywgc2VydmljZVRva2VuPzogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoZGF0YXNldC50aHVtYm5haWxfZmlsZSkge1xuICAgICAgY29uc3QgdGh1bWJuYWlsRmlsZSA9IGRhdGFzZXQudGh1bWJuYWlsX2ZpbGUgYXMgSnNvbkRpY3Q7XG4gICAgICByZXR1cm4gYCR7YXNzZXRzQXBpfS8ke3RodW1ibmFpbEZpbGUuZmlsZV91dWlkfS8ke3RodW1ibmFpbEZpbGUuZmlsZW5hbWV9YCArIChzZXJ2aWNlVG9rZW4gPyBgP3Rva2VuPSR7c2VydmljZVRva2VufWAgOiAnJyk7XG4gICAgfSBlbHNlIGlmIChkYXRhc2V0Lmdyb3VwX3V1aWQgPT09ICc3M2JiMjZlNC1lZDQzLTExZTgtOGYxOS0wYTdjMWVhYjAwN2EnKSB7IC8vIFRNQy1WYW5kZXJiaWx0XG4gICAgICBjb25zdCB0aWZmcyA9IChnZXQoZGF0YXNldCwgJ21ldGFkYXRhLmZpbGVzJywgW10pIGFzIHsgcmVsX3BhdGg6IHN0cmluZyB9W10pXG4gICAgICAgIC5maWx0ZXIoZiA9PiAvXFwuKG9tZVxcLnRpZnxvbWVcXC50aWZmKSQvLnRlc3QoZi5yZWxfcGF0aCkpXG4gICAgICAgIC5maWx0ZXIoZiA9PiAhLyhtdWx0aWxheWVyXFwub21lXFwudGlmfF9hY1xcLm9tZVxcLnRpZikvLnRlc3QoZi5yZWxfcGF0aCkpXG4gICAgICAgIC5maWx0ZXIoZiA9PiBEUjFfVlVfVEhVTUJTLmhhcyhcbiAgICAgICAgICBmLnJlbF9wYXRoLnNwbGl0KCcvJykuc2xpY2UoLTEpWzBdLnNwbGl0KCc/JylbMF0ucmVwbGFjZSgnLm9tZS50aWYnLCAnX3RodW1ibmFpbC5qcGcnKVxuICAgICAgICApKVxuICAgICAgICAubWFwKGYgPT4gYCR7YXNzZXRzQXBpfS8ke2RhdGFzZXQudXVpZH0vJHtmLnJlbF9wYXRofWAgKyAoc2VydmljZVRva2VuID8gYD90b2tlbj0ke3NlcnZpY2VUb2tlbn1gIDogJycpKTtcblxuICAgICAgaWYgKHRpZmZzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgdGh1bWIgPSB0aWZmc1swXS5zcGxpdCgnLycpLnNsaWNlKC0xKVswXS5zcGxpdCgnPycpWzBdLnJlcGxhY2UoJy5vbWUudGlmJywgJ190aHVtYm5haWwuanBnJyk7XG4gICAgICAgIGlmIChEUjFfVlVfVEhVTUJTLmhhcyh0aHVtYikpIHtcbiAgICAgICAgICByZXR1cm4gYGFzc2V0cy90aHVtYm5haWxzL1RNQy1WYW5kZXJiaWx0L0RSMS8ke3RodW1ifWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRhdGFzZXQuZ3JvdXBfdXVpZCA9PT0gJzA3YTI5ZTRjLWVkNDMtMTFlOC1iNTZhLTBlODAxN2JkZGE1OCcpIHsgLy8gVE1DLUZsb3JpZGFcbiAgICAgIGNvbnN0IHRodW1iID0gVUZMX1RIVU1CU1tkYXRhc2V0Lmh1Ym1hcF9pZCBhcyBzdHJpbmddO1xuICAgICAgaWYgKHRodW1iKSB7XG4gICAgICAgIHJldHVybiBgYXNzZXRzL3RodW1ibmFpbHMvVE1DLUZsb3JpZGEvJHt0aHVtYn1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0RG9ub3IoZG9ub3I6IEpzb25EaWN0LCBwb3J0YWxVcmw6IHN0cmluZyk6IEpzb25MZE9iaiB7XG4gICAgY29uc3QgZG9ub3JEZXNjcmlwdGlvbiA9IChkb25vci5kZXNjcmlwdGlvbiBhcyBzdHJpbmcgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IHNleDogJ01hbGUnIHwgJ0ZlbWFsZScgfCB1bmRlZmluZWQ7XG4gICAgaWYgKGRvbm9yRGVzY3JpcHRpb24uaW5jbHVkZXMoJ2ZlbWFsZScpKSB7XG4gICAgICBzZXggPSAnRmVtYWxlJztcbiAgICB9IGVsc2UgaWYgKGRvbm9yRGVzY3JpcHRpb24uaW5jbHVkZXMoJ21hbGUnKSkge1xuICAgICAgc2V4ID0gJ01hbGUnO1xuICAgIH1cbiAgICBjb25zdCBhZ2VNYXRjaCA9IGRvbm9yRGVzY3JpcHRpb24ubWF0Y2goL2FnZSAoWzAtOV0rKS8pO1xuICAgIGxldCBhZ2U6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgICBpZiAoYWdlTWF0Y2gpIHtcbiAgICAgIGFnZSA9IHRvTnVtYmVyKGFnZU1hdGNoWzFdKTtcbiAgICB9XG4gICAgbGV0IGJtaTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIGZvciAoY29uc3QgbWQgb2YgZ2V0KGRvbm9yLCAnbWV0YWRhdGEub3JnYW5fZG9ub3JfZGF0YScsIGdldChkb25vciwgJ21ldGFkYXRhLmxpdmluZ19kb25vcl9kYXRhJywgW10pKSBhcyBKc29uRGljdFtdKSB7XG4gICAgICBpZiAobWQucHJlZmVycmVkX3Rlcm0gPT09ICdGZW1pbmluZSBnZW5kZXInIHx8IG1kLnByZWZlcnJlZF90ZXJtID09PSAnRmVtYWxlJykge1xuICAgICAgICBzZXggPSAnRmVtYWxlJztcbiAgICAgIH0gZWxzZSBpZiAobWQucHJlZmVycmVkX3Rlcm0gPT09ICdNYXNjdWxpbmUgZ2VuZGVyJyB8fCBtZC5wcmVmZXJyZWRfdGVybSA9PT0gJ01hbGUnKSB7XG4gICAgICAgIHNleCA9ICdNYWxlJztcbiAgICAgIH0gZWxzZSBpZiAobWQucHJlZmVycmVkX3Rlcm0gPT09ICdDdXJyZW50IGNocm9ub2xvZ2ljYWwgYWdlJyB8fCBtZC5wcmVmZXJyZWRfdGVybSA9PT0gJ0FnZScpIHtcbiAgICAgICAgYWdlID0gdG9OdW1iZXIobWQuZGF0YV92YWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKG1kLnByZWZlcnJlZF90ZXJtID09PSAnQm9keSBtYXNzIGluZGV4Jykge1xuICAgICAgICBibWkgPSB0b051bWJlcihtZC5kYXRhX3ZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGxhYmVsID0gJyc7XG4gICAgaWYgKHNleCAmJiBhZ2UpIHtcbiAgICAgIGxhYmVsICs9IGAke3NleH0sIEFnZSAke2FnZX1gO1xuICAgICAgaWYgKGJtaSkge1xuICAgICAgICBsYWJlbCArPSBgLCBCTUkgJHtibWkudG9GaXhlZCgxKX1gO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGVFbnRlcmVkID0gbmV3IERhdGUoZG9ub3IubGFzdF9tb2RpZmllZF90aW1lc3RhbXAgYXMgbnVtYmVyKS50b0xvY2FsZURhdGVTdHJpbmcoKTtcbiAgICBjb25zdCBncm91cE5hbWUgPSBHUk9VUF9VVUlEX01BUFBJTkdbZG9ub3IuZ3JvdXBfdXVpZCBhcyBzdHJpbmddIHx8IGRvbm9yLmdyb3VwX25hbWUgYXMgc3RyaW5nO1xuICAgIGNvbnN0IGNyZWF0b3IgPSBkb25vci5jcmVhdGVkX2J5X3VzZXJfZGlzcGxheW5hbWU7XG5cbiAgICByZXR1cm4ge1xuICAgICAgJ0BpZCc6IEhCTV9QUkVGSVggKyBkb25vci51dWlkLFxuICAgICAgJ0B0eXBlJzogJ0Rvbm9yJyxcbiAgICAgIGxhYmVsLFxuICAgICAgZGVzY3JpcHRpb246IGBFbnRlcmVkICR7ZGF0ZUVudGVyZWR9LCAke2NyZWF0b3J9LCAke2dyb3VwTmFtZX1gLFxuICAgICAgbGluazogYCR7cG9ydGFsVXJsfWJyb3dzZS9kb25vci8ke2Rvbm9yLnV1aWR9YCxcblxuICAgICAgYWdlLFxuICAgICAgc2V4LFxuICAgICAgYm1pLFxuXG4gICAgICBjb25zb3J0aXVtX25hbWU6ICdIdUJNQVAnLFxuICAgICAgcHJvdmlkZXJfbmFtZTogZ3JvdXBOYW1lLFxuICAgICAgcHJvdmlkZXJfdXVpZDogZG9ub3IuZ3JvdXBfdXVpZCBhcyBzdHJpbmcsXG5cbiAgICAgIHNhbXBsZXM6IFtdXG4gICAgfTtcbiAgfVxuXG4gIGdldFJ1aUxvY2F0aW9uKGRhdGE6IEpzb25EaWN0LCBkb25vcjogSnNvbkxkT2JqKTogSnNvbkxkT2JqIHwgdW5kZWZpbmVkIHtcbiAgICBsZXQgc3BhdGlhbEVudGl0eTogSnNvbkxkT2JqIHwgdW5kZWZpbmVkO1xuICAgIGxldCBydWlMb2NhdGlvbiA9IGRhdGEucnVpX2xvY2F0aW9uIGFzIEpzb25EaWN0O1xuICAgIGlmIChydWlMb2NhdGlvbikge1xuICAgICAgLy8gUlVJIExvY2F0aW9uIG1heSBjb21lIGluIGFzIGFuIHVucGFyc2VkIHN0cmluZ1xuICAgICAgaWYgKHR5cGVvZiBydWlMb2NhdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcnVpTG9jYXRpb24gPSBKU09OLnBhcnNlKHJ1aUxvY2F0aW9uIGFzIHN0cmluZykgYXMgSnNvbkRpY3Q7XG4gICAgICB9XG4gICAgICBpZiAocnVpTG9jYXRpb24uYWxpZ25tZW50X2lkKSB7IC8vIERldGVjdCBSVUkgMC41IGdlbmVyYXRlZCBKU09OXG4gICAgICAgIGNvbnNvbGUubG9nKCdEZXRlY3RlZCBhIGRlcHJlY2F0ZWQgcnVpX2xvY2F0aW9uJywgZGF0YS51dWlkKTtcbiAgICAgIH0gZWxzZSBpZiAoKHJ1aUxvY2F0aW9uIGFzIHVua25vd24gYXMgeyAnQGlkJzogc3RyaW5nIH0pWydAaWQnXSkgeyAvLyBEZXRlY3QgUlVJIDEuMCsgZ2VuZXJhdGVkIEpTT04tTERcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgc3BhdGlhbEVudGl0eSA9IHJ1aUxvY2F0aW9uIGFzIHVua25vd24gYXMgSnNvbkxkT2JqO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc3BhdGlhbEVudGl0eSkge1xuICAgICAgLy8gUGF0Y2ggdG8gZml4IFJVSSAwLjUgS2lkbmV5IGFuZCBTcGxlZW4gUGxhY2VtZW50c1xuICAgICAgY29uc3QgdGFyZ2V0OiBzdHJpbmcgPSBnZXQoc3BhdGlhbEVudGl0eSwgWydwbGFjZW1lbnQnLCAndGFyZ2V0J10pID8/ICcnO1xuICAgICAgaWYgKHRhcmdldC5zdGFydHNXaXRoKCdodHRwOi8vcHVybC5vcmcvY2NmL2xhdGVzdC9jY2Yub3dsI1ZIU3BsZWVuQ0MnKSkge1xuICAgICAgICBpZiAoZG9ub3Iuc2V4ID09PSAnTWFsZScpIHtcbiAgICAgICAgICBzZXQoc3BhdGlhbEVudGl0eSwgWydwbGFjZW1lbnQnLCAndGFyZ2V0J10sIHRhcmdldC5yZXBsYWNlKCcjVkhTcGxlZW5DQycsICcjVkhNU3BsZWVuQ0MnKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0KHNwYXRpYWxFbnRpdHksIFsncGxhY2VtZW50JywgJ3RhcmdldCddLCB0YXJnZXQucmVwbGFjZSgnI1ZIU3BsZWVuQ0MnLCAnI1ZIRlNwbGVlbkNDJykpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRhcmdldCA9PT0gJ2h0dHA6Ly9wdXJsLm9yZy9jY2YvbGF0ZXN0L2NjZi5vd2wjVkhMZWZ0S2lkbmV5JyB8fCB0YXJnZXQgPT09ICdodHRwOi8vcHVybC5vcmcvY2NmL2xhdGVzdC9jY2Yub3dsI1ZIUmlnaHRLaWRuZXknKSB7XG4gICAgICAgIGlmIChkb25vci5zZXggPT09ICdNYWxlJykge1xuICAgICAgICAgIHNldChzcGF0aWFsRW50aXR5LCBbJ3BsYWNlbWVudCcsICd0YXJnZXQnXSwgdGFyZ2V0LnJlcGxhY2UoJyNWSCcsICcjVkhNJykgKyAnX1BhdGNoJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0KHNwYXRpYWxFbnRpdHksIFsncGxhY2VtZW50JywgJ3RhcmdldCddLCB0YXJnZXQucmVwbGFjZSgnI1ZIJywgJyNWSEYnKSArICdfUGF0Y2gnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3BhdGlhbEVudGl0eTtcbiAgfVxuXG4gIGdldFRpc3N1ZUJsb2NrKCk6IEpzb25MZE9iaiB7XG4gICAgcmV0dXJuIG9taXQoeyAuLi50aGlzIH0sIFsnZGF0YScsICdiYWQnLCAnZG9ub3InXSkgYXMgdW5rbm93biBhcyBKc29uTGRPYmo7XG4gIH1cblxuICB0b0pzb25MZCgpOiBKc29uTGRPYmoge1xuICAgIHJldHVybiB7IC4uLnRoaXMuZG9ub3IsIHNhbXBsZXM6IFt0aGlzLmdldFRpc3N1ZUJsb2NrKCldIH07XG4gIH1cbn1cbiJdfQ==