<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Library ccf-database documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avaoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);

               if ($darkModeToggles.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">Library ccf-database documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  Portal</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/ccf-database/src/lib/xconsortia/xconsortia-data.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#assets" 
>
                                            assets
                                        </a>
                                </li>
                                <li>
                                        <a href="#donorName" 
>
                                            donorName
                                        </a>
                                </li>
                                <li>
                                        <a href="#idPrefix" 
>
                                            idPrefix
                                        </a>
                                </li>
                                <li>
                                        <a href="#portal" 
>
                                            portal
                                        </a>
                                </li>
                                <li>
                                        <a href="#portalParams" 
>
                                            portalParams
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="assets"></a>
                                        <span class="name "><b>assets</b>
                                            <a href="#assets">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>assets:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="donorName"></a>
                                        <span class="name "><b>donorName</b>
                                            <a href="#donorName">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>donorName:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="idPrefix"></a>
                                        <span class="name "><b>idPrefix</b>
                                            <a href="#idPrefix">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>idPrefix:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="portal"></a>
                                        <span class="name "><b>portal</b>
                                            <a href="#portal">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>portal:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="portalParams"></a>
                                        <span class="name "><b>portalParams</b>
                                            <a href="#portalParams">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>portalParams:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { JsonLd, JsonLdObj } from &#x27;jsonld/jsonld-spec&#x27;;
import lodash from &#x27;lodash&#x27;;
import { patchJsonLd } from &#x27;../util/patch-jsonld&#x27;;

const { get, omit, set, toNumber } &#x3D; lodash;

type JsonDict &#x3D; Record&lt;string, unknown&gt;;

interface Portal {
  idPrefix: string;
  portal: string;
  portalParams: string;
  donorName: string;
  assets: string;
}

const HUBMAP: Portal &#x3D; {
  idPrefix: &#x27;https://entity.api.hubmapconsortium.org/entities/&#x27;,
  portal: &#x27;https://portal.hubmapconsortium.org/browse/&#x27;,
  portalParams: &#x27;/&#x27;,
  donorName: &#x27;donor&#x27;,
  assets: &#x27;https://assets.hubmapconsortium.org&#x27;
};

const SENNET: Portal &#x3D; {
  idPrefix: &#x27;https://entity.api.sennetconsortium.org/entities/&#x27;,
  portal: &#x27;https://data.sennetconsortium.org/&#x27;,
  portalParams: &#x27;?uuid&#x3D;&#x27;,
  donorName: &#x27;source&#x27;,
  assets: &#x27;https://assets.sennetconsortium.org&#x27;
};


// eslint-disable-next-line max-len
export const DR1_VU_THUMBS &#x3D; new Set([&#x27;VAN0003-LK-32-21-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0009-LK-102-7-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0009-LK-102-7-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0009-LK-102-7-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0009-LK-102-7-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0010-LK-155-40-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0010-LK-155-40-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0010-LK-155-40-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0010-LK-155-40-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-96-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-96-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-96-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-96-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-97-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-97-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-97-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0013-LK-202-97-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0014-LK-203-108-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0014-LK-203-108-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0014-LK-203-108-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0014-LK-203-108-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0016-LK-202-89-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0016-LK-202-89-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0016-LK-202-89-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0016-LK-202-89-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-21-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0003-LK-32-22-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-1-1-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0005-RK-4-172-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-85-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0006-LK-2-86-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0007-LK-203-103-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-100-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0008-RK-403-101-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-10-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0011-RK-3-11-MxIF_cyc3_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-AF_preIMS_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-IMS_NegMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-IMS_PosMode_multilayer_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-75-PAS_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-AF_preMxIF_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc1_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc2_registered_thumbnail.jpg&#x27;, &#x27;VAN0012-RK-103-76-MxIF_cyc3_registered_thumbnail.jpg&#x27;]);
// eslint-disable-next-line max-len
export const UFL_THUMBS &#x3D; { &#x27;HBM558.SRZG.629&#x27;: &#x27;HBM558.SRZG.629_UFL0002-SP-3-4-1.jpg&#x27;, &#x27;HBM562.NTMH.548&#x27;: &#x27;HBM562.NTMH.548_UFL0006-SP-1-2-1.jpg&#x27;, &#x27;HBM685.KHRQ.684&#x27;: &#x27;HBM685.KHRQ.684_UFL0008-LY07-1-1.jpg&#x27;, &#x27;HBM278.SFQW.627&#x27;: &#x27;HBM278.SFQW.627_UFL0008-LY09-1-1.jpg&#x27;, &#x27;HBM427.SMGB.866&#x27;: &#x27;HBM427.SMGB.866_UFL0004-SP-1-4-1.jpg&#x27;, &#x27;HBM432.LLCF.677&#x27;: &#x27;HBM432.LLCF.677_UFL0001-SP-2-5-1.jpg&#x27;, &#x27;HBM586.ZSVS.996&#x27;: &#x27;HBM586.ZSVS.996_UFL0008-SP-1-1-1.jpg&#x27;, &#x27;HBM285.XMBT.542&#x27;: &#x27;HBM285.XMBT.542_UFL0006-TH-1-3-1.jpg&#x27;, &#x27;HBM289.BWJW.663&#x27;: &#x27;HBM289.BWJW.663_UFL0006-TH-1-2-1.jpg&#x27;, &#x27;HBM255.SRPR.985&#x27;: &#x27;HBM255.SRPR.985_UFL0005-TH-2-2-1.jpg&#x27;, &#x27;HBM799.WXHD.535&#x27;: &#x27;HBM799.WXHD.535_UFL0009-LY02-1-1.jpg&#x27;, &#x27;HBM294.RZFN.624&#x27;: &#x27;HBM294.RZFN.624_UFL0005-TH-1-1-1.jpg&#x27;, &#x27;HBM383.TRQG.424&#x27;: &#x27;HBM383.TRQG.424_UFL0006-SP-1-3-1.jpg&#x27;, &#x27;HBM647.MFQB.496&#x27;: &#x27;HBM647.MFQB.496_UFL0001-SP-1-2-1.jpg&#x27;, &#x27;HBM237.GGPR.739&#x27;: &#x27;HBM237.GGPR.739_UFL0006-LY01-1-1.jpg&#x27;, &#x27;HBM288.TPBD.654&#x27;: &#x27;HBM288.TPBD.654_UFL0003-SP-2-2-1.jpg&#x27;, &#x27;HBM974.NDXT.675&#x27;: &#x27;HBM974.NDXT.675_UFL0008-TH-2-2-1.jpg&#x27;, &#x27;HBM589.SLVV.423&#x27;: &#x27;HBM589.SLVV.423_UFL0008-LY10-1-1.jpg&#x27;, &#x27;HBM794.RLFN.358&#x27;: &#x27;HBM794.RLFN.358_UFL0006-LY03-1-1.jpg&#x27;, &#x27;HBM372.BQSR.778&#x27;: &#x27;HBM372.BQSR.778_UFL0007-SP-1-1-1.jpg&#x27;, &#x27;HBM499.TKDW.458&#x27;: &#x27;HBM499.TKDW.458_UFL0009-LY03-1-1.jpg&#x27;, &#x27;HBM342.PRQB.739&#x27;: &#x27;HBM342.PRQB.739_UFL0003-LY06-1-1.jpg&#x27;, &#x27;HBM633.CLVN.674&#x27;: &#x27;HBM633.CLVN.674_UFL0003-SP-3-6-1.jpg&#x27;, &#x27;HBM343.JQKM.578&#x27;: &#x27;HBM343.JQKM.578_UFL0009-LY01-1-1.jpg&#x27;, &#x27;HBM987.XGTH.368&#x27;: &#x27;HBM987.XGTH.368_UFL0002-SP-2-4-1.jpg&#x27;, &#x27;HBM964.CWCP.788&#x27;: &#x27;HBM964.CWCP.788_UFL0006-LY02-2-1.jpg&#x27;, &#x27;HBM244.TJLK.223&#x27;: &#x27;HBM244.TJLK.223_UFL0003-SP-1-4-1.jpg&#x27;, &#x27;HBM646.FSBQ.966&#x27;: &#x27;HBM646.FSBQ.966_UFL0007-SP-2-2-1.jpg&#x27;, &#x27;HBM572.GXSB.234&#x27;: &#x27;HBM572.GXSB.234_UFL0003-SP-3-2-1.jpg&#x27;, &#x27;HBM772.TKGJ.794&#x27;: &#x27;HBM772.TKGJ.794_UFL0008-SP-2-1-1.jpg&#x27;, &#x27;HBM239.CBWR.263&#x27;: &#x27;HBM239.CBWR.263_UFL0008-SP-1-2-1.jpg&#x27;, &#x27;HBM992.NRTT.383&#x27;: &#x27;HBM992.NRTT.383_UFL0006-SP-1-1-1.jpg&#x27;, &#x27;HBM283.DQXD.546&#x27;: &#x27;HBM283.DQXD.546_UFL0003-SP-1-2-1.jpg&#x27;, &#x27;HBM795.JHND.856&#x27;: &#x27;HBM795.JHND.856_UFL0007-SP-1-2-1.jpg&#x27;, &#x27;HBM267.BZKT.867&#x27;: &#x27;HBM267.BZKT.867_UFL0003-SP-2-6-1.jpg&#x27;, &#x27;HBM838.DLMJ.782&#x27;: &#x27;HBM838.DLMJ.782_UFL0008-TH-1-1-1.jpg&#x27;, &#x27;HBM337.FSXL.564&#x27;: &#x27;HBM337.FSXL.564_UFL0001-SP-3-8-2.jpg&#x27;, &#x27;HBM355.JDLK.244&#x27;: &#x27;HBM355.JDLK.244_UFL0004-SP-2-4-1.jpg&#x27;, &#x27;HBM599.PSZG.737&#x27;: &#x27;HBM599.PSZG.737_UFL0006-LY02-1-1.jpg&#x27; };

/** UUID to TMC mapping. */
const GROUP_UUID_MAPPING: { [uuid: string]: string } &#x3D; {
  &#x27;03b3d854-ed44-11e8-8bce-0e368f3075e8&#x27;: &#x27;TMC-UCSD&#x27;,
  &#x27;07a29e4c-ed43-11e8-b56a-0e8017bdda58&#x27;: &#x27;TMC-Florida&#x27;,
  &#x27;308f5ffc-ed43-11e8-b56a-0e8017bdda58&#x27;: &#x27;TMC-CalTech&#x27;,
  &#x27;5bd084c8-edc2-11e8-802f-0e368f3075e8&#x27;: &#x27;HBM-TestingGroup&#x27;,
  &#x27;73bb26e4-ed43-11e8-8f19-0a7c1eab007a&#x27;: &#x27;TMC-Vanderbilt&#x27;,
  &#x27;def5fd76-ed43-11e8-b56a-0e8017bdda58&#x27;: &#x27;TMC-Stanford&#x27;,
  &#x27;5c106f29-ea2d-11e9-85e8-0efb3ba9a670&#x27;: &#x27;RTI-General Electric&#x27;,
  &#x27;301615f9-c870-11eb-a8dc-35ce3d8786fe&#x27;: &#x27;TMC-UConn&#x27;
};

const ENTITY_CONTEXT &#x3D; &#x27;https://hubmapconsortium.github.io/ccf-ontology/ccf-context.jsonld&#x27;;

/**
 * Converts a hubmap response object into JsonLd.
 *
 * @param data The hubmap data.
 * @returns The converted data.
 */
export function xConsortiaResponseAsJsonLd(data: unknown, serviceToken?: string, debug &#x3D; false): JsonLd {
  const entries &#x3D; (get(data, &#x27;hits.hits&#x27;, []) as JsonDict[])
    .map(e &#x3D;&gt; get(e, &#x27;_source&#x27;, {}) as JsonDict)
    .sort((a, b) &#x3D;&gt; (a[&#x27;uuid&#x27;] as string).localeCompare(b[&#x27;uuid&#x27;] as string));

  const donorLookup: Record&lt;string, JsonLdObj&gt; &#x3D; {};
  const unflattened: JsonLdObj[] &#x3D; entries.map(e &#x3D;&gt;
    new HuBMAPTissueBlock(e, serviceToken).toJsonLd()
  );
  for (const donor of unflattened) {
    const donorId &#x3D; donor[&#x27;@id&#x27;] as string;
    if (!donorLookup[donorId]) {
      donorLookup[donorId] &#x3D; donor;
    } else {
      const samples &#x3D; donorLookup[donorId].samples as JsonLdObj[];
      samples.push((donor.samples as JsonLdObj[])[0]);
    }
  }
  const donors &#x3D; Object.values(donorLookup);

  if (debug) {
    debugDonors(donors);
    console.log(donors.map(d &#x3D;&gt; ({ &#x27;@context&#x27;: ENTITY_CONTEXT, ...d })));
  }

  return patchJsonLd(JSON.stringify({ &#x27;@context&#x27;: ENTITY_CONTEXT, &#x27;@graph&#x27;: donors }), ENTITY_CONTEXT);
}

function debugDonors(donors: JsonLdObj[]) {
  let datasets: JsonLdObj[] &#x3D; [];
  let deleted &#x3D; 0;
  for (const donor of donors.filter(d &#x3D;&gt; (d.samples as []).length &gt; 1)) {
    const samples &#x3D; donor.samples as JsonLdObj[];
    for (let i&#x3D;0; i &lt; samples.length; i++) {
      const blockId &#x3D; samples[i][&#x27;@id&#x27;] as string;
      datasets &#x3D; datasets.concat(samples[i].datasets as JsonLdObj[]);
      for (const section of samples[i].sections as JsonLdObj[]) {
        datasets &#x3D; datasets.concat(section.datasets as JsonLdObj[]);
      }
      for (let j&#x3D;i+1; j &lt; samples.length; j++) {
        const sections &#x3D; samples[j].sections as JsonLdObj[];
        if (sections.find(s &#x3D;&gt; s[&#x27;@id&#x27;] &#x3D;&#x3D;&#x3D; blockId)) {
          samples[i].deleteMe &#x3D; true;
          deleted++;
        }
      }
    }
    donor.samples &#x3D; samples.filter(s &#x3D;&gt; s.deleteMe !&#x3D;&#x3D; true);
  }
  if (deleted &gt; 0) {
    console.log(&#x60;âš  ${deleted} sections identified as blocks&#x60;);
  }
}

export class HuBMAPTissueBlock {
  bad &#x3D; false;
  donor: JsonLdObj;

  &#x27;@id&#x27;: string;
  &#x27;@type&#x27; &#x3D; &#x27;Sample&#x27;;
  label: string;
  description: string;
  link: string;

  sample_type &#x3D; &#x27;Tissue Block&#x27;;
  section_count: number;
  section_size: number;
  section_units: string;

  rui_location: JsonLdObj;
  sections: JsonLdObj[];
  datasets: JsonLdObj[];

  portal: Portal;

  constructor(public data: JsonDict, serviceToken?: string) {
    const entityType &#x3D; this.data.entity_type;
    if (entityType !&#x3D;&#x3D; &#x27;Sample&#x27;) {
      this.bad &#x3D; true;
      return;
    }
    if (data.sennet_id) {
      this.portal &#x3D; SENNET;
    } else if (data.hubmap_id) {
      this.portal &#x3D; HUBMAP;
    } else {
      this.bad &#x3D; true;
      return;
    }

    const descendants &#x3D; (this.data.descendants || []) as JsonDict[];
    const donor &#x3D; (this.data.donor ?? this.data.source) as JsonDict;
    this.donor &#x3D; this.getDonor(donor);
    const ruiLocation &#x3D; this.getRuiLocation(data, this.donor);
    if (!ruiLocation) {
      this.bad &#x3D; true;
    } else {
      this.rui_location &#x3D; ruiLocation;
    }

    if (!GROUP_UUID_MAPPING[data.group_uuid as string]) {
      GROUP_UUID_MAPPING[data.group_uuid as string] &#x3D; data.group_name as string;
    }

    const dateEntered &#x3D; new Date(data.last_modified_timestamp as number).toLocaleDateString();
    const groupName &#x3D; GROUP_UUID_MAPPING[data.group_uuid as string] || data.group_name as string;
    const creator &#x3D; data.created_by_user_displayname;

    this[&#x27;@id&#x27;] &#x3D; this.portal.idPrefix + data.uuid;
    this.label &#x3D; &#x60;Registered ${dateEntered}, ${creator}, ${groupName}&#x60;;
    this.link &#x3D; &#x60;${this.portal.portal}sample${this.portal.portalParams}${data.uuid}&#x60;;

    const sectionLookup: Record&lt;string, JsonLdObj&gt; &#x3D; {};
    const sections: JsonLdObj[] &#x3D; [];
    this.sections &#x3D; sections;
    const datasets: JsonLdObj[] &#x3D; [];
    this.datasets &#x3D; datasets;

    for (const descendant of descendants.filter(d &#x3D;&gt; d.entity_type &#x3D;&#x3D;&#x3D; &#x27;Sample&#x27;)) {
      const section &#x3D; this.getSection(descendant, data);

      const sectionId &#x3D; descendant.submission_id as string;
      sectionLookup[sectionId] &#x3D; section;
      sections.push(section);
      section.section_number &#x3D; section.section_number ?? sections.length;
    }
    for (const descendant of descendants) {
      if (descendant.entity_type &#x3D;&#x3D;&#x3D; &#x27;Dataset&#x27;) {
        const dataset &#x3D; this.getDataset(descendant, serviceToken);

        const sectionId &#x3D; get(descendant, [&#x27;ingest_metadata&#x27;, &#x27;metadata&#x27;, &#x27;tissue_id&#x27;]) as string;
        if (sectionLookup[sectionId]) {
          (sectionLookup[sectionId].datasets as JsonLd[])?.push(dataset);
        } else {
          datasets.push(dataset);
        }
      }
    }

    const loc: JsonDict &#x3D; ruiLocation ?? {};
    const dims &#x3D; &#x60;${loc.x_dimension} x ${loc.y_dimension} x ${loc.z_dimension} ${loc.dimension_units}&#x60;;
    this.section_count &#x3D; loc.slice_count as number || sections.length;
    const sSize &#x3D; parseFloat(
      (loc.slice_thickness as number ||
        ((loc.z_dimension as number || 0) / Math.max(this.section_count, 1)))
        .toFixed(1)
    );
    this.section_size &#x3D; sSize;
    const sUnits &#x3D; loc.dimension_units as string || &#x27;millimeter&#x27;;
    this.section_units &#x3D; sUnits;

    this.description &#x3D; &#x60;${dims}, ${sSize} ${sUnits}, ${this.section_count} Sections&#x60;;

    sections.forEach((section, index) &#x3D;&gt; {
      section.description &#x3D; &#x60;${loc.x_dimension} x ${loc.y_dimension} x ${sSize} ${sUnits}, ${sSize} ${sUnits}, ${section.description}&#x60;;
      section.section_number &#x3D; index + 1;
    });
  }

  getSection(section: JsonDict, data: JsonDict): JsonLdObj {
    const dateEntered &#x3D; new Date(section.last_modified_timestamp as number).toLocaleDateString();
    const groupName &#x3D; GROUP_UUID_MAPPING[section.group_uuid as string] || section.group_name as string;
    const creator &#x3D; section.created_by_user_displayname;

    return {
      &#x27;@id&#x27;: this.portal.idPrefix + section.uuid,
      &#x27;@type&#x27;: &#x27;Sample&#x27;,
      label: &#x60;Registered ${dateEntered}, ${creator}, ${groupName}&#x60;,
      description: &#x60;${data.sample_category}&#x60;,
      link: &#x60;${this.portal.portal}sample${this.portal.portalParams}${section.uuid}&#x60;,

      sample_type: &#x27;Tissue Section&#x27;,
      section_number: 1,

      samples: [],
      datasets: []
    };
  }

  getDataset(dataset: JsonDict, serviceToken?: string): JsonLdObj {
    const dateEntered &#x3D; new Date(dataset.last_modified_timestamp as number).toLocaleDateString();
    const groupName &#x3D; GROUP_UUID_MAPPING[dataset.group_uuid as string] || dataset.group_name as string;
    const creator &#x3D; dataset.created_by_user_displayname;

    const types &#x3D; (dataset.dataset_type ?? &#x27;&#x27;) as string;
    const typesSearch &#x3D; types.toLowerCase();

    let technology: string;
    let thumbnail &#x3D; &#x27;assets/icons/ico-unknown.svg&#x27;;
    if (typesSearch.indexOf(&#x27;10x&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;10x&#x27;;
      thumbnail &#x3D; &#x27;assets/icons/ico-bulk-10x.svg&#x27;;
    } else if (typesSearch.indexOf(&#x27;af&#x27;) !&#x3D;&#x3D; -1 || typesSearch.indexOf(&#x27;auto-fluorescence&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;AF&#x27;;
      thumbnail &#x3D; &#x27;assets/icons/ico-spatial-af.svg&#x27;;
    } else if (typesSearch.indexOf(&#x27;codex&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;CODEX&#x27;;
      thumbnail &#x3D; &#x27;assets/icons/ico-spatial-codex.svg&#x27;;
    } else if (typesSearch.indexOf(&#x27;imc&#x27;) !&#x3D;&#x3D; -1 || typesSearch.indexOf(&#x27;imaging mass cytometry&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;IMC&#x27;;
      thumbnail &#x3D; &#x27;assets/icons/ico-spatial-imc.svg&#x27;;
    } else if ((typesSearch.indexOf(&#x27;lc&#x27;) !&#x3D;&#x3D; -1) &amp;&amp; (typesSearch.indexOf(&#x27;af&#x27;) &#x3D;&#x3D;&#x3D; -1)) {
      technology &#x3D; &#x27;LC&#x27;;
      thumbnail &#x3D; &#x27;assets/icons/ico-bulk-lc.svg&#x27;;
    } else if (typesSearch.indexOf(&#x27;maldi&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;MALDI&#x27;;
    } else if (typesSearch.indexOf(&#x27;pas&#x27;) !&#x3D;&#x3D; -1) {
      technology &#x3D; &#x27;PAS&#x27;;
    } else {
      technology &#x3D; types.split(/ \[/)[0];
    }
    thumbnail &#x3D; this.getDatasetThumbnail(dataset, serviceToken) ?? thumbnail;

    return {
      &#x27;@id&#x27;: this.portal.idPrefix + dataset.uuid,
      &#x27;@type&#x27;: &#x27;Dataset&#x27;,
      label: &#x60;Registered ${dateEntered}, ${creator}, ${groupName}&#x60;,
      description: &#x60;Dataset Type: ${types}&#x60;,
      link: &#x60;${this.portal.portal}dataset${this.portal.portalParams}${dataset.uuid}&#x60;,
      technology,
      thumbnail
    };
  }

  getDatasetThumbnail(dataset: JsonDict, serviceToken?: string): string | undefined {
    if (dataset.thumbnail_file) {
      const thumbnailFile &#x3D; dataset.thumbnail_file as JsonDict;
      return &#x60;${this.portal.assets}/${thumbnailFile.file_uuid}/${thumbnailFile.filename}&#x60; + (serviceToken ? &#x60;?token&#x3D;${serviceToken}&#x60; : &#x27;&#x27;);
    } else if (dataset.group_uuid &#x3D;&#x3D;&#x3D; &#x27;73bb26e4-ed43-11e8-8f19-0a7c1eab007a&#x27;) { // TMC-Vanderbilt
      const tiffs &#x3D; (get(dataset, &#x27;metadata.files&#x27;, []) as { rel_path: string }[])
        .filter(f &#x3D;&gt; /\.(ome\.tif|ome\.tiff)$/.test(f.rel_path))
        .filter(f &#x3D;&gt; !/(multilayer\.ome\.tif|_ac\.ome\.tif)/.test(f.rel_path))
        .filter(f &#x3D;&gt; DR1_VU_THUMBS.has(
          f.rel_path.split(&#x27;/&#x27;).slice(-1)[0].split(&#x27;?&#x27;)[0].replace(&#x27;.ome.tif&#x27;, &#x27;_thumbnail.jpg&#x27;)
        ))
        .map(f &#x3D;&gt; &#x60;${this.portal.assets}/${dataset.uuid}/${f.rel_path}&#x60; + (serviceToken ? &#x60;?token&#x3D;${serviceToken}&#x60; : &#x27;&#x27;));

      if (tiffs.length &gt; 0) {
        const thumb &#x3D; tiffs[0].split(&#x27;/&#x27;).slice(-1)[0].split(&#x27;?&#x27;)[0].replace(&#x27;.ome.tif&#x27;, &#x27;_thumbnail.jpg&#x27;);
        if (DR1_VU_THUMBS.has(thumb)) {
          return &#x60;assets/thumbnails/TMC-Vanderbilt/DR1/${thumb}&#x60;;
        }
      }
    } else if (dataset.group_uuid &#x3D;&#x3D;&#x3D; &#x27;07a29e4c-ed43-11e8-b56a-0e8017bdda58&#x27;) { // TMC-Florida
      const thumb &#x3D; UFL_THUMBS[dataset.hubmap_id as string];
      if (thumb) {
        return &#x60;assets/thumbnails/TMC-Florida/${thumb}&#x60;;
      }
    }
    return undefined;
  }

  getDonor(donor: JsonDict): JsonLdObj {
    const donorDescription &#x3D; (donor.description as string || &#x27;&#x27;).toLowerCase();
    let sex: &#x27;Male&#x27; | &#x27;Female&#x27; | undefined;
    if (donorDescription.includes(&#x27;female&#x27;)) {
      sex &#x3D; &#x27;Female&#x27;;
    } else if (donorDescription.includes(&#x27;male&#x27;)) {
      sex &#x3D; &#x27;Male&#x27;;
    }
    const ageMatch &#x3D; donorDescription.match(/age ([0-9]+)/) ?? donorDescription.match(/ ([0-9]+) years/);
    let age: number | undefined;
    if (ageMatch) {
      age &#x3D; toNumber(ageMatch[1]);
    }
    let bmi: number | undefined;
    let race: string | undefined;
    const metadata &#x3D; get(donor, &#x27;mapped_metadata&#x27;, get(donor, &#x27;source_mapped_metadata&#x27;, {})) as Record&lt;string, unknown[]&gt;;
    if (!sex &amp;&amp; metadata.sex?.length &gt; 0) {
      sex &#x3D; metadata.sex[0] as &#x27;Male&#x27; | &#x27;Female&#x27; | undefined;
    }
    if (!race &amp;&amp; metadata.race?.length &gt; 0) {
      race &#x3D; metadata.race[0] as string;
    }
    if (!age &amp;&amp; metadata.age_value?.length &gt; 0) {
      age &#x3D; metadata.age_value[0] as number | undefined;
    }
    if (!bmi &amp;&amp; metadata.body_mass_index_value?.length &gt; 0) {
      bmi &#x3D; metadata.body_mass_index_value[0] as number | undefined;
    }
    for (const md of get(donor, &#x27;metadata.organ_donor_data&#x27;, get(donor, &#x27;metadata.living_donor_data&#x27;, [])) as JsonDict[]) {
      if (md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Feminine gender&#x27; || md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Female&#x27;) {
        sex &#x3D; &#x27;Female&#x27;;
      } else if (md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Masculine gender&#x27; || md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Male&#x27;) {
        sex &#x3D; &#x27;Male&#x27;;
      } else if (md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Current chronological age&#x27; || md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Age&#x27;) {
        age &#x3D; toNumber(md.data_value);
      } else if (md.preferred_term &#x3D;&#x3D;&#x3D; &#x27;Body mass index&#x27;) {
        bmi &#x3D; toNumber(md.data_value);
      } else if (md.grouping_concept_preferred_term &#x3D;&#x3D;&#x3D; &#x27;Race&#x27;) {
        race &#x3D; md.preferred_term as string;
      }
    }
    let label &#x3D; &#x27;&#x27;;
    if (sex &amp;&amp; age) {
      label +&#x3D; &#x60;${sex}, Age ${age}&#x60;;
      if (bmi) {
        label +&#x3D; &#x60;, BMI ${bmi.toFixed(1)}&#x60;;
      }
    } else if (sex) {
      label &#x3D; sex;
    }

    const dateEntered &#x3D; new Date(donor.last_modified_timestamp as number).toLocaleDateString();
    const groupName &#x3D; GROUP_UUID_MAPPING[donor.group_uuid as string] || donor.group_name as string;
    const creator &#x3D; donor.created_by_user_displayname;

    return {
      &#x27;@id&#x27;: this.portal.idPrefix + donor.uuid,
      &#x27;@type&#x27;: &#x27;Donor&#x27;,
      label,
      description: &#x60;Entered ${dateEntered}, ${creator}, ${groupName}&#x60;,
      link: &#x60;${this.portal.portal}${this.portal.donorName}${this.portal.portalParams}${donor.uuid}&#x60;,

      age,
      sex,
      bmi,
      race,

      consortium_name: this.portal &#x3D;&#x3D;&#x3D; HUBMAP ? &#x27;HuBMAP&#x27; : &#x27;SenNet&#x27;,
      provider_name: groupName,
      provider_uuid: donor.group_uuid as string,

      samples: []
    };
  }

  getRuiLocation(data: JsonDict, donor: JsonLdObj): JsonLdObj | undefined {
    let spatialEntity: JsonLdObj | undefined;
    let ruiLocation &#x3D; data.rui_location as JsonDict;
    if (ruiLocation) {
      // RUI Location may come in as an unparsed string
      if (typeof ruiLocation &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
        ruiLocation &#x3D; JSON.parse(ruiLocation as string) as JsonDict;
      }
      if (ruiLocation.alignment_id) { // Detect RUI 0.5 generated JSON
        console.log(&#x27;Detected a deprecated rui_location&#x27;, data.uuid);
      } else if ((ruiLocation as unknown as { &#x27;@id&#x27;: string })[&#x27;@id&#x27;]) { // Detect RUI 1.0+ generated JSON-LD
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        spatialEntity &#x3D; ruiLocation as unknown as JsonLdObj;
      }
      ruiLocation[&#x27;@context&#x27;] &#x3D; &#x27;https://hubmapconsortium.github.io/ccf-ontology/ccf-context.jsonld&#x27;;
    }
    if (spatialEntity) {
      // Patch to fix RUI 0.5 Kidney and Spleen Placements
      const target: string &#x3D; get(spatialEntity, [&#x27;placement&#x27;, &#x27;target&#x27;]) ?? &#x27;&#x27;;
      if (target.startsWith(&#x27;http://purl.org/ccf/latest/ccf.owl#VHSpleenCC&#x27;)) {
        if (donor.sex &#x3D;&#x3D;&#x3D; &#x27;Male&#x27;) {
          set(spatialEntity, [&#x27;placement&#x27;, &#x27;target&#x27;], target.replace(&#x27;#VHSpleenCC&#x27;, &#x27;#VHMSpleenCC&#x27;));
        } else {
          set(spatialEntity, [&#x27;placement&#x27;, &#x27;target&#x27;], target.replace(&#x27;#VHSpleenCC&#x27;, &#x27;#VHFSpleenCC&#x27;));
        }
      } else if (target &#x3D;&#x3D;&#x3D; &#x27;http://purl.org/ccf/latest/ccf.owl#VHLeftKidney&#x27; || target &#x3D;&#x3D;&#x3D; &#x27;http://purl.org/ccf/latest/ccf.owl#VHRightKidney&#x27;) {
        if (donor.sex &#x3D;&#x3D;&#x3D; &#x27;Male&#x27;) {
          set(spatialEntity, [&#x27;placement&#x27;, &#x27;target&#x27;], target.replace(&#x27;#VH&#x27;, &#x27;#VHM&#x27;) + &#x27;_Patch&#x27;);
        } else {
          set(spatialEntity, [&#x27;placement&#x27;, &#x27;target&#x27;], target.replace(&#x27;#VH&#x27;, &#x27;#VHF&#x27;) + &#x27;_Patch&#x27;);
        }
      }
    }
    return spatialEntity;
  }

  getTissueBlock(): JsonLdObj {
    return omit({ ...this }, [&#x27;data&#x27;, &#x27;bad&#x27;, &#x27;donor&#x27;, &#x27;portal&#x27;]) as unknown as JsonLdObj;
  }

  toJsonLd(): JsonLdObj {
    return { ...this.donor, samples: [this.getTissueBlock()] };
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Portal.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
